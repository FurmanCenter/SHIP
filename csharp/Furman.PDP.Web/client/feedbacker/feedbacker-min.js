var Feedbacker={};(function(a,b){var c=function(p){var l={},n=b.extend({id:"feedbacker",target:"body",display:"float",orientation:"topright",topText:"",css:null,contentCss:null,animate:true,tabButton:true,tabImage:true,shadow:true,shadowHidden:true,hideDefaulted:false,openButton:{text:"Feedback",target:"",cssClass:""},cssPath:"client/feedbacker/css/feedbacker.css",submitUrl:"handlers/feedbacker/feedback.ashx",jsonp:false,onSuccess:null,onError:null,typeList:["General","Inquiry","Suggestion","Other"],customValues:{},appName:"",fields:[{id:"Firstname",type:"text",label:"First Name"},{id:"Lastname",type:"text",label:"Last Name"},{id:"Email",type:"text",label:"Email Address",required:true},{id:"Type",type:"list",label:"Type of Feedback",list:[]},{id:"Comment",type:"longtext",label:"Comments",required:true}]},p);var o,d,k;function m(){var q=true;b.each(n.fields,function(t,u){if(u.required){var r="#"+n.id+"-"+u.id;var s=b(r,d);if(!s.val()){q=false;s.addClass("feedbacker-error").focus();return false}else{s.removeClass("feedbacker-error")}}});return q}function e(q){q._method="PUT";var r={url:n.submitUrl,data:q,type:"POST",dataType:"json",success:function(s){if(n.onSuccess&&typeof n.onSuccess==="function"){n.onSuccess.call(l,s)}l.reset()},error:function(s){if(n.onError&&typeof n.onError==="function"){n.onError.call(l,s)}else{alert("Error occurred submitting feedback.")}}};if(n.jsonp){r.type="GET";r.dataType="jsonp";r.jsonp="jsonp_callback"}b.ajax(r)}function g(q){if(n.tabButton){var r={};switch(n.orientation.toLowerCase()){case"topright":r.height=0;break;case"topleft":r.height=0;break;case"topcenter":r.height=0;break;case"topfull":r.height=0;break;case"right":r.width=0;break;case"left":r.width=0;break;default:break}var s=k.outerHeight()+k.position().top;if(n.animate&&!q){d.animate(r,"fast",function(){o.css({height:s,width:0});d.hide()})}else{d.css(r);o.css({height:s,width:0});d.hide()}}else{o.hide()}o.removeClass("feedbacker-float-open");if(n.shadow&&n.shadowHidden){d.removeClass("feedbacker-content-shadow")}}function i(q,s){if(n.tabButton){var r={};switch(n.orientation.toLowerCase()){case"topright":r.height=q+"px";break;case"topleft":r.height=q+"px";break;case"topcenter":r.height=q+"px";break;case"topfull":r.height=q+"px";break;case"right":r.width=s+"px";break;case"left":r.width=s+"px";break;default:break}if(n.animate){o.css({height:"auto",width:"auto"});d.show();d.animate(r,"fast")}else{o.css({height:"auto",width:"auto"});d.show();d.css(r)}}else{o.show()}o.addClass("feedbacker-float-open");if(n.shadow&&n.shadowHidden){d.addClass("feedbacker-content-shadow")}}function j(q){var s="";if(q&&b.isArray(q)){var t,r;b.each(q,function(u,v){t="";r="";if(typeof v==="string"){t=v;r=v}else{if(b.isArray(v)){t=v[0];r=v[1]}else{t=v.value;r=v.name}}if(t&&r){s+='<option value="'+t+'">'+r+"</option>"}})}return s}function f(){o=b('<div id="'+n.id+'" class="feedbacker"></div>').appendTo(n.target);d=b('<div class="feedbacker-content"></div>').appendTo(o);var B=o;if(n.css){o.css(n.css)}if(n.shadow){d.addClass("feedbacker-content-shadow")}if(n.contentCss){d.css(n.contentCss)}var z=0,q=0;if(n.display==="float"){o.addClass("feedbacker-float feedbacker-float-open");if(n.target!=="body"){var C=b(n.target).css("position");if(C!=="relative"&&C!=="absolute"){b(n.target).css("position","relative")}}var r="paddingLeft";switch(n.orientation.toLowerCase()){case"topright":o.addClass("feedbacker-floatTopRight");break;case"topleft":o.addClass("feedbacker-floatTopLeft");break;case"topcenter":o.addClass("feedbacker-floatTopCenter");break;case"topfull":o.addClass("feedbacker-floatTopFull");break;case"right":o.addClass("feedbacker-floatRight");break;case"left":o.addClass("feedbacker-floatLeft");r="paddingRight";break;default:break}if(n.openButton){var u=n.openButton.target||n.target;if(typeof n.openButton==="string"){k=b(n.openButton)}else{if(n.openButton.target){k=b('<span class="feedbacker-openbutton">'+n.openButton.text+"</span>").appendTo(u);if(n.openButton.cssClass){k.addClass(n.openButton.cssClass)}}else{if(n.tabButton){k=b('<div class="feedbacker-openbutton feedbacker-openbutton-tab"><strong>'+n.openButton.text+"</strong></div>").appendTo(o);if(n.tabImage){k.addClass("feedbacker-openbutton-imgtab")}o.css(r,(k.width()+4)+"px");B=d;if(n.openButton.cssClass){k.addClass(n.openButton.cssClass)}}else{k=n.openButton}}}k.click(function(){if(o.hasClass("feedbacker-float-open")){g()}else{i(z,q)}})}}if(n.topText){b("<span/>").appendTo(d).append(n.topText)}var v=b('<ul class="feedbacker-list feedbacker-fieldlist"></ul>').appendTo(d);var t,x,y,A,w;b.each(n.fields,function(E,F){var G=F.defaultVal||"";if(n.hideDefaulted&&G){F.type="hidden"}t=n.id+"-"+F.id;x=b('<li class="feedbacker-field"></li>').appendTo(v);y=b('<label for="'+t+'">'+F.label+"</label>").appendTo(x);if(F.required){y.append('<span class="feedbacker-required">*</span>');w=true}switch(F.type){case"yesno":break;case"longtext":A=b('<textarea id="'+t+'" name="'+t+'" class="feedbacker-textinput feedbacker-biginput"></textarea>').appendTo(x).val(G);break;case"list":var D=j(F.list);A=b('<select id="'+t+'" name="'+t+'" class="feedbacker-listinput"></select>').appendTo(x).append(D).val(G);break;case"hidden":A=b('<input id="'+t+'" name="'+t+'" type="hidden" />').appendTo(x).val(G);x.hide();break;default:A=b('<input id="'+t+'" name="'+t+'" type="text" class="feedbacker-textinput" />').appendTo(x).val(G);break}});z=d.outerHeight();q=d.outerWidth();if(n.display==="float"&&n.openButton){g(true)}if(w){b('<span class="feedbacker-required">* = Required</span>').appendTo(d)}var s=b('<div class="feedbacker-buttons"></div>').appendTo(d);if(n.display==="float"){b('<button class="feedbacker-button">Cancel</button>').appendTo(s).click(function(){g();b(".feedbacker-error",d).removeClass("feedbacker-error");return false})}b('<button class="feedbacker-button">Submit</button>').appendTo(s).click(function(){if(m()){var D=b.extend({appName:n.appName},n.customValues);b.each(n.fields,function(F,G){var E="#"+n.id+"-"+G.id;var H=b(E,d).val();D[G.id]=H});e(D);if(n.display==="float"){g()}}return false})}function h(){var q=document.getElementsByTagName("head")[0]||document.documentElement;if(b('link[href*="feedbacker.css"]',q).length===0&&n.cssPath){var r=document.createElement("link");r.setAttribute("type","text/css");r.setAttribute("rel","stylesheet");r.setAttribute("class","feedbacker-theme");r.href=n.cssPath;q.insertBefore(r,q.firstChild)}}l.reset=function(){var q;b.each(n.fields,function(r,s){q=n.id+"-"+s.id;var t=s.defaultVal||"";b("#"+q).val(t)})};l.addCSS=function(){h()};l.init=function(){if(n.typeList.length){b.each(n.fields,function(q,r){if(r.id.toLowerCase()==="type"&&r.type==="list"){if(!r.list||(r.list&&b.isArray(r.list)&&r.list.length===0)){r.list=n.typeList}}})}f()};return l};a.init=function(e){var d=c(e);d.addCSS();b(document).ready(function(){d.init()})}}(Feedbacker,jQuery));
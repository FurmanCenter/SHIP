(function(c){c.Data={path:""};var b=function(f,e,g,h,d){$.ajax({url:e,data:g,type:f,dataType:"json",success:function(i){if(h&&typeof h==="function"){h(i)}},error:function(k,i,j){if(d&&typeof d==="function"){d(k.responseText)}else{Azavea.log(i);Azavea.log(j)}}})};var a=Azavea.tryCatch("convert object to querystring",function(e){var d="?";var f;for(f in e){if(e.hasOwnProperty(f)&&(e[f]||e[f]===0)){d+=encodeURIComponent(f)+"="+encodeURIComponent(e[f])+"&"}}return d.substring(0,d.length-1)});c.Data.login=Azavea.tryCatch("user login",function(i,f,h,e){var d=c.Data.path+"handlers/login.ashx";var g={username:i,password:f};b("POST",d,g,h,e)});c.Data.checkLoginStatus=Azavea.tryCatch("user login",function(f,e){var d=c.Data.path+"handlers/login.ashx";b("GET",d,{},f,e)});c.Data.logout=Azavea.tryCatch("user login",function(f,e){var d=c.Data.path+"handlers/logout.ashx";b("POST",d,{},f,e)});c.Data.resetPassword=Azavea.tryCatch("data reset password",function(h,g,e){var d=c.Data.path+"handlers/reset-password.ashx";var f={username:h};b("POST",d,f,g,e)});c.Data.createUser=Azavea.tryCatch("data create user",function(g,d,i,k,h,l,j){var e=c.Data.path+"handlers/users.ashx";var f={username:g,name:d,email:i,password:k,roles:h};b("POST",e,f,l,j)});c.Data.getUser=Azavea.tryCatch("data get user",function(h,g,e){var d=c.Data.path+"handlers/users.ashx";var f={username:h};b("GET",d,f,g,e)});c.Data.getUsers=Azavea.tryCatch("data get users",function(i,d,k,g,j,f){var e=c.Data.path+"handlers/users.ashx";var h={page:i,pageSize:d,sortby:k,sortasc:g};b("GET",e,h,j,f)});c.Data.updateUser=Azavea.tryCatch("data create user",function(g,d,i,k,h,l,j){var e=c.Data.path+"handlers/users.ashx";var f={username:g,name:d,email:i,password:k,roles:h,_method:"PUT"};b("POST",e,f,l,j)});c.Data.getAttributes=Azavea.tryCatch("data get attributes",function(f,e){var d=c.Data.path+"handlers/attributes.ashx";b("GET",d,null,f,e)});c.Data.getProperties=function(k,f,i,h,l,e,m,j){if(k&&typeof k==="object"){k=JSON.stringify(k)}if(e&&typeof e==="object"){e=JSON.stringify(e)}var d=c.Data.path+"handlers/properties.ashx";var g={pagesize:f,page:i,criteria:k,sortby:h,sortasc:l,groupby:e};b("GET",d,g,m,j)};c.Data.getPropertiesCsv=Azavea.tryCatch("get properties cvs",function(g,d){if(g&&typeof g==="object"){g=JSON.stringify(g)}if(d&&typeof d==="object"){d=JSON.stringify(d)}var e=c.Data.path+"handlers/properties.ashx";var f={csv:true,pagesize:-1,page:-1,criteria:g,sortby:-1,sortasc:false,groupby:d};window.location.href=e+a(f)});c.Data.getPropertyReport=Azavea.tryCatch("get property report",function(f){var d=c.Data.path+"handlers/report-download.ashx";var e={propertyId:f};window.location.href=d+a(e)});c.Data.checkPropertyReportExists=function(g,h,e){var d=c.Data.path+"handlers/report-download.ashx";var f={propertyId:g};b("POST",d,f,h,e)};c.Data.getPropertyLocations=function(m,p,n,l,j,h,g,f,d,o,k){if(m&&typeof m==="object"){m=JSON.stringify(m)}var e=c.Data.path+"handlers/property-locations.ashx";var i={criteria:m,minx:p,miny:n,maxx:l,maxy:j,minBx:h,maxBx:f,minBy:g,maxBy:d};b("GET",e,i,o,k)};c.Data.getPropertyDetails=function(f,h,e){var d=c.Data.path+"handlers/property-details.ashx";var g={ids:f};b("GET",d,g,h,e)};c.Data.getNychanisMeta=Azavea.tryCatch("data get Nychanis metadata",function(f,e){var d=c.Data.path+"handlers/nyc-meta.ashx";b("GET",d,null,f,e)});c.Data.getNychanis=Azavea.tryCatch("data get Nychanis",function(g,l,k,n,o,f,j,i,e,r,q,p,m){var d=c.Data.path+"handlers/nychanis.ashx";var h={pagesize:g,page:l,sortby:k,sortasc:n,indicator:o,resolution:f,timetype:j,minyear:i,maxyear:e,borough:r,subborough:q};b("GET",d,h,p,m)});c.Data.getNychanisCsv=Azavea.tryCatch("data get Nychanis csv",function(j,f,i,h,e,l,k){var d=c.Data.path+"handlers/nychanis.ashx";var g={csv:true,pagesize:-1,page:-1,sortby:-1,sortasc:false,indicator:j,resolution:f,timetype:i,minyear:h,maxyear:e,borough:l,subborough:k};window.location.href=d+a(g)})}(PDP));(function(a){var b=a.Util.prefix;a.Form={validators:{required:{password:function(f,c,e){var d="#"+b(e,f.id);if($(d).is(":visible")){if(!$(d).val()){$(d+", "+d+"-2").addClass(b(e,"input-invalid"))}}return true},_default:function(f,c,e){var d="#"+b(e,f.id);if(!$(d).val()){$(d).addClass(b(e,"input-invalid"));return false}else{return true}}},password:function(h,c,g){var f="#"+b(g,h.id);if($(f).is(":visible")){var e=$(f).val(),d=$(f+"-2").val();if(e!==d){$(f+", "+f+"-2").addClass(b(g,"input-invalid"));a.Form.validationMsg+="Passwords do not match.";return false}}return true},email:function(g,c,f){var e="#"+b(f,g.id);if($(e).is(":visible")){var d=$(e).val();if(d.indexOf("@")===-1||d.indexOf(".")===-1){$(e).addClass(b(f,"input-invalid"));a.Form.validationMsg+="Email is not valid.";return false}}return true},number:function(h,c,f){var e="#"+b(f,h.id);var d=$(e).val();if(d){d=d.replace(/[$,]/g,"")}var g=/^\d*\.?\d*$/;if(d===null||!g.test(d)){$(e).addClass(b(f,"input-invalid"));a.Form.validationMsg+="Not a valid number";return false}return true},rangeLower:function(g,c,e){var d="#"+b(e,g.id);if(a.Form.validators.number(g,c,e)){var f=parseFloat($(d).val());if(f===null||f>c.upper){$(d).addClass(b(e,"input-invalid"));a.Form.validationMsg+="The lower range value is greater than the upper range value.";return false}}else{return false}return true},rangeUpper:function(g,d,f){var e="#"+b(f,g.id);if(a.Form.validators.number(g,d,f)){var c=parseFloat($(e).val());if(c===null||c<d.lower){$(e).addClass(b(f,"input-invalid"));a.Form.validationMsg+="The upper range value is less than the lower range value.";return false}}else{return false}return true},range:function(f,c,e){var d="#"+b(e,f.id);if(a.Form.validators.number(f,c,e)){var g=parseFloat($(d).val());if(g===null||g<c.min||g>c.max){$(d).addClass(b(e,"input-invalid"));a.Form.validationMsg+="The value is not between ["+c.min+"] and ["+c.max+"]";return false}return true}return false}},validate:function(c,f,e,h){a.Form.validationMsg="";$("."+b(h,"input-invalid"),e||".pdp-form").removeClass(b(h,"input-invalid"));var g=true,d=true;$.each(c,function(j,l){if(l.required){var k=a.Form.validators.required[l.type||""]||a.Form.validators.required._default;if(!k(l,f,h)){g=false;if(d){a.Form.validationMsg+="Please enter all required fields.";d=false}}}if(g&&l.validator&&a.Form.validators[l.validator]){g=a.Form.validators[l.validator](l,f,h)&&g}});return g},setupRequired:function(c,d){$.each(c,function(e,f){if(f.required){$("label[for="+f.id+"]",d).append('<span class="pdp-form-required-label">Required</span>')}})}}}(PDP));(function(a){a.Widget.Login=function(n){var k={},m=$.extend({target:"body",bindTo:a,fields:[{id:"pdp-login-username",required:true},{id:"pdp-login-password",required:true}],adminUrl:"admin/manage-users.aspx",logoutUrl:"default.aspx",profileUrl:"user/profile.aspx",appUrl:""},n),b;var j=Azavea.tryCatch("clear form errors",function(){$(".input-invalid",b).removeClass("input-invalid");$(".pdp-form-messages",b).remove()});var i=Azavea.tryCatch("create and render the login form",function(){var p="",o="";b=$('<div class="pdp-header-panel pdp-login-panel pdp-closable-panel ui-corner-all pdp-shadow-drop"><h2>Log In</h2><div id="pdp-login-panel-close"><span class="ui-icon ui-icon-circle-close"></span></div><fieldset class=""><ul><li><label for="pdp-login-username" class="pdp-form-label">Username:</label><div class="pdp-form-ctrl"><input id="pdp-login-username" type="text" class="pdp-input pdp-input-shorttext" tabindex="1" /></div></li><li><label for="pdp-login-password" class="pdp-form-label">Password:</label><div class="pdp-form-ctrl"><input id="pdp-login-password" type="password" class="pdp-input pdp-input-shorttext" tabindex="2" /></div></li><li><div class="pdp-form-buttons"><button id="pdp-login-button" class="pdp-button pdp-input-button-primary" tabindex="3">Log In</button><a href="javascript:void(0);" id="pdp-show-password-reset">Forgot Password?</a></div></li></ul></fieldset></div>');p='<fieldset class="pdp-password-reset-container"><h2>Reset Password</h2><ul><li><label for="pdp-reset-password-username" class="">Enter your username to reset your password:</label><div class="pdp-form-ctrl"><input id="pdp-reset-password-username" type="text" class="pdp-input pdp-input-shorttext" tabindex="4" /></div></li></ul><div class="pdp-form-buttons"><button id="pdp-reset-password-button" value="Reset Password" class="pdp-button pdp-input-button-primary" tabindex="5">Reset Password</button></div></fieldset>';b.append(p).hide();$(".pdp-password-reset-container",b).hide();$("#pdp-login-password",b).keyup(function(q){if(q.which===13){$("#pdp-login-button").click()}});$("#pdp-reset-password-username",b).keyup(function(q){if(q.which===13){$("#pdp-reset-password-button").click()}});$("#pdp-login-panel-close",b).click(function(q){b.hide()});$("#pdp-show-password-reset",b).click(function(q){j();$(".pdp-password-reset-container").toggle()});o=$('<a href="javascript:void(0);" class="pdp-link pdp-header-link">Login</a>');o.click(function(q){if(b.is(":visible")){b.hide()}else{b.show();j();$(".pdp-input:first",".pdp-login-panel").focus()}});$(m.target).empty().append(o,b)});var d=Azavea.tryCatch("display login info",function(p){var r="",o="",q={};$("pdp-login-panel").remove();$("pdp-login-link").remove();r='Welcome,<a href="'+decodeURI(m.appUrl+m.profileUrl)+'" class="pdp-link pdp-header-link">'+p.Name+"</a>";if(p.Admin){o='<a href="'+decodeURI(m.appUrl+m.adminUrl)+'" class="pdp-link pdp-header-link">User Administration</a>'}q=$('<a href="javascript:void(0);" class="pdp-link pdp-header-link">Logout</a>');q.click(function(s){a.Data.logout(function(){window.location.href=decodeURIComponent(m.logoutUrl)})});$(m.target).empty().append(r,o,q)});var l=Azavea.tryCatch("init login",function(){$("#pdp-login-button").button().click(function(){if(!$(this).hasClass("pdp-input-button-disabled")){$(".pdp-form-messages").remove();$(this).addClass("pdp-input-button-disabled").val("Checking login...");if(a.Form.validate(m.fields,{},m.target)){var p=$("#pdp-login-username").val(),o=$("#pdp-login-password").val();a.Data.login(p,o,function(q){location.reload(true);$(m.bindTo).trigger("pdp-login-success",[q]);d(q)},function(q){c(q)})}else{c(a.Form.validationMsg);$(".pdp-input-invalid:first",".pdp-login-panel").focus()}}})});var g=Azavea.tryCatch("initialize password reset",function(){$("#pdp-reset-password-button").button().click(function(){$(".pdp-form-messages").remove();if(a.Form.validate([{id:"pdp-reset-password-username",required:true}],{},m.target)){var o=$("#pdp-reset-password-username").val();a.Data.resetPassword(o,function(p){h(p)},function(p){c(p)})}else{c(a.Form.validationMsg);$(".pdp-input-invalid:first",".pdp-login-panel").focus()}})});var f=Azavea.tryCatch("display error message",function(p,o){$('<div class="pdp-form-messages '+o+'">'+p+"</div>").appendTo(".pdp-login-panel");$("#pdp-login-button").removeClass("pdp-input-button-disabled").val("Log In")});var c=Azavea.tryCatch("display error message",function(o){f(o,"ui-state-error")});var h=Azavea.tryCatch("display error message",function(o){f(o,"")});var e=Azavea.tryCatch("refresh login panel",function(p,o){if(o){d(o)}else{i();l();g()}});k.init=Azavea.tryCatch("init widget login",function(){$(m.bindTo).bind("pdp-login-status-refresh",e);return k});return k}}(PDP));(function(a){a.Widget.Signup=function(j){var g={},i=$.extend({target:"body",bindTo:a,fields:[{id:"pdp-signup-username",required:true},{id:"pdp-signup-name",required:true},{id:"pdp-signup-email",required:true,validator:"email"},{id:"pdp-signup-password",required:true,validator:"password"},{id:"pdp-signup-password-2",required:true}],signupTarget:"pdp-header-signup",landingUrl:"default.aspx"},j),c;var e=Azavea.tryCatch("clear form errors",function(){$(".input-invalid",c).removeClass("input-invalid");$(".pdp-form-messages",c).remove()});var h=Azavea.tryCatch("create and render the signup form",function(){var l=$(b()).hide();$("#pdp-signup-password-2",l).keyup(function(m){if(m.which===13){$("#pdp-signup-button").click()}});$("#pdp-signup-panel-close",l).click(function(m){l.hide()});var k=$('<a href="javascript:void(0);" class="pdp-link pdp-signup-link">Sign Up</a>');k.click(function(m){if(l.is(":visible")){l.hide()}else{$(".pdp-header-panel").hide();l.show();e();$("#pdp-signup-username",".pdp-signup-panel").focus()}});$(i.target).empty().append(k,l)});var f=Azavea.tryCatch("init signup",function(){$("#pdp-signup-button").button().click(function(){if(!$(this).hasClass("pdp-input-button-disabled")){$(".pdp-form-messages").remove();$(this).addClass("pdp-input-button-disabled").val("Creating User...");if(a.Form.validate(i.fields,{},".pdp-signup-panel")){var n=$("#pdp-signup-username").val(),m=$("#pdp-signup-password").val(),l=$("#pdp-signup-name").val(),k=$("#pdp-signup-email").val();roles="";a.Data.createUser(n,l,k,m,roles,function(){a.Data.login(n,m,function(o){$(i.bindTo).trigger("pdp-login-success",[o]);$(i.bindTo).trigger("pdp-login-status-refresh",[o])},function(){window.location.href=i.landingUrl})},function(o){d(o)})}else{d(a.Form.validationMsg);$(".pdp-input-invalid:first",".pdp-signup-panel").focus()}}})});var b=Azavea.tryCatch("generate signup form markup",function(){var k='<div class="pdp-header-panel pdp-signup-panel ui-corner-all pdp-closable-panel pdp-shadow-drop"><div id="pdp-signup-panel-close"><span class="ui-icon ui-icon-circle-close"></span></div><h2 class="pdp-header-panel-title">Sign Up</h2><fieldset class=""><ul class="pdp-form-list"><li><label for="pdp-signup-username" class="pdp-form-label">User Name:</label><div class="pdp-form-ctrl"><input id="pdp-signup-username" type="text" class="pdp-input-shorttext" tabindex="1" /></div></li><li><label for="pdp-signup-name" class="pdp-form-label">Name:</label><div class="pdp-form-ctrl"><input id="pdp-signup-name" type="text" class="pdp-input-shorttext" tabindex="2" /></div></li><li><label for="pdp-signup-email" class="pdp-form-label">Email:</label><div class="pdp-form-ctrl"><input id="pdp-signup-email" type="text" class="pdp-input-shorttext" tabindex="3" /></div></li></ul><ul class="pdp-form-list"><li><label for="pdp-signup-password" class="pdp-form-label">Password:</label><div class="pdp-form-ctrl"><input id="pdp-signup-password" type="password" class="pdp-input-shorttext" tabindex="4" /></div></li><li><label for="pdp-signup-password-2" class="pdp-form-label">Confirm Password:</label><div class="pdp-form-ctrl"><input id="pdp-signup-password-2" type="password" class="pdp-input-shorttext" tabindex="5" /></div></li></ul><div class="pdp-form-buttons"><button id="pdp-signup-button" class="pdp-button" tabindex="7">Sign Up</button></div></fieldset><div class="pdp-header-panel-desc">* Signing up allows you to view and filter by extra property characteristics in SHIP (Subsidized Housing Information Project).  This special access is granted to agency partners and others who have made arrangements with the Furman Center.</div></div>';return k});var d=Azavea.tryCatch("display error message",function(k){$('<div class="pdp-form-messages ui-state-error">'+k+"</div>").appendTo(".pdp-signup-panel");$("#pdp-signup-button").removeClass("pdp-input-button-disabled").val("Sign Up")});g.init=Azavea.tryCatch("init widget signup",function(){$(i.bindTo).bind("pdp-login-status-refresh",function(l,k){if(!k){h();f();$(i.target).show()}});$(i.bindTo).bind("pdp-login-success",function(){$(i.target).hide()});return g});return g}}(PDP));(function(a){a.Widget.ColumnSelector=function(p){var k={},n=$.extend({target:"body",bindTo:a},p),j=a,c={},e={},o;var f=Azavea.tryCatch("trigger visibility event",function(q){var r=l();$(n.bindTo).trigger("pdb-column-visibility",[r,q])});var m=Azavea.tryCatch("render select columns panel",function(q){var r=Azavea.tryCatch("render pdb counts attrs",function(t,s){$.each(t,function(v,y){if(y.Attrs){var u=$('<li rel="'+y.Order+'"><div class="pdb-column-select-category"><label class="pdb-column-select-category-label">'+y.Name+'</label></div><ul class="pdp-column-select-category"></ul></li>').appendTo(s);var w=parseInt(y.Order,10)-1;var x=s.children('li[rel="'+w.toString()+'"]');if(x.length){u.insertAfter(x)}else{u.appendTo(s)}r(y.Attrs,u.children("ul.pdp-column-select-category"));if(y.SubCats&&y.SubCats.length){r(y.SubCats,$("ul.pdp-column-select-category",u))}}else{if(y.Category&&y.Name){$('<li rel="'+y.CategoryOrder+'"><input type="checkbox" id="col-sel-'+y.UID+'" /><label for="col-sel-'+y.UID+'" class="pdp-pdb-column-label">'+y.QueryName+"</label></li>").appendTo(s)}}})});$('<div id="pdp-column-select-panel" class="pdp-closable-panel pdp-shadow-drop"><div id="pdp-column-select-panel-content"><a id="pdp-col-select-all" class="pdp-link" href="javascript:void(0);">Select All</a><a id="pdp-col-select-none" class="pdp-link" href="javascript:void(0);">Select None</a><div id="pdp-column-select-panel-close"><span class="ui-icon ui-icon-circle-close"></span></div><ul id="pdp-column-select-panel-cols"></ul></div></div>').appendTo(n.target).hide();r(q,$("#pdp-column-select-panel-cols"));$("ul.pdp-column-category:empty").parent().remove()});var i=Azavea.tryCatch("show column list",function(r){var q=$("#pdp-column-select-panel");q.toggle();$(this).toggleClass("pdp-column-selector-active");if(!q.attr("visible")){$.each(e,function(t,s){$("#col-sel-"+s.UID,q).attr("checked",s.visible)})}});var d=Azavea.tryCatch("set all column visibility",function(r,q){$("input:checkbox",q).attr("checked",r);$.each(e,function(t,s){s.visible=r});f()});var h=Azavea.tryCatch("get column index",function(s){var r,q=-1;for(r in e){if(e.hasOwnProperty(r,false)){q++;if(r===s){return q}}}return false});var b=Azavea.tryCatch("create column panel",function(q,s){var r={};$(n.target).empty();o=$('<button class="pdp-column-selector pdp-closable-panel-button">Choose Columns</button>');o.click(i).hide().button();$(n.target).append(o);m(s.List);r=$("#pdp-column-select-panel");$("#pdp-column-select-panel-close").click(function(t){r.hide()});$("#pdp-col-select-all").click(function(t){d(true,r)});$("#pdp-col-select-none").click(function(t){d(false,r)});$("input:checkbox",r).change(function(t){e[this.id].visible=$(this).attr("checked");f(h(this.id))})});var l=Azavea.tryCatch("get column visibility array",function(){var q=[];$.each(c.Attrs,function(s,r){if(r.Name){q.push(e["col-sel-"+r.UID].visible)}else{q.push(false)}});return q});var g=Azavea.tryCatch("col-sel handle new data response",function(s,r){if(!o){return}if(r.GroupByQuery){o.hide()}else{o.show()}var q=Azavea.superEquals(c.Attrs,r.Attrs);c=r;if(!q){$.each(c.Attrs,function(u,t){e["col-sel-"+t.UID]={colIndex:u,visible:t.OnByDefault,UID:t.UID}})}});k.init=Azavea.tryCatch("init app",function(){$(n.bindTo).bind("pdp-data-response",g);$(n.bindTo).bind("pdp-pdb-attributes",b);$(n.bindTo).bind("pdp-criteria-reset",function(){if(o){o.hide()}});return k});return k}}(PDP));(function(d){var b=Azavea.tryCatch("trigger property criteria change",function(g){$(d.Widget.PdbControls.bindTo).trigger("pdp-pdb-control-change",[g])});var e=Azavea.tryCatch("resetting a control widget",function(g){$(d.Widget.PdbControls.bindTo).bind("pdp-criteria-reset",function(h){if(g){g()}})});var f=Azavea.tryCatch("creating control container",function(i,g,h){return $('<div class="pdp-pdb-control"><div class="pdp-pdb-control-label ui-state-default"><label class="">'+g+'</label><span class="pdp-pdb-control-label-help ui-icon ui-icon-help" title="'+h+'"></span></div></div>')});var c=Azavea.tryCatch("sort: compare dropdown values",function(i,g){var j=i.Value.toLowerCase();var h=g.Value.toLowerCase();if(j<h){return -1}if(j>h){return 1}return 0});var a=Azavea.tryCatch("sort: compare group dropdown values",function(i,g){var j,h;if(i.Group){j=i.Group.toLowerCase()}else{return 0}if(g.Group){h=g.Group.toLowerCase()}else{return 0}if(j<h){return -1}if(j>h){return 1}return 0});d.Widget.PdbControls={bindTo:d.Pdb,dropdown:Azavea.tryCatch("creating dropdown control",function(i,m){var o=f(m.UID,m.QueryName||m.Name,m.Desc),h=[],l="";var k=$('<select id="'+m.UID+'"></select>');var n=Azavea.tryCatch("dropdown control change",function(q){var s=this.value;if(s){if($.inArray(s,h)!==-1){k.val("");return}var p=$("option:selected",$(this)).attr("disabled","disabled").hide();o.addClass("pdp-pdb-control-active");var r=$('<div class="pdp-selected-criteria"><span class="ui-icon ui-icon-close left" title="Remove this filter"></span><label title="'+s+'">'+s+"</label></div>").insertBefore(this);h.push(s);$(".ui-icon",r).click(function(u){var t=$("label",r).text();$.each(h,function(v,w){if(w===t){h.splice(v,1);return false}});p.removeAttr("disabled").show();r.remove();b([{attr:k.attr("id"),oper:"eq",val:h}]);if($(".pdp-selected-criteria",o).length===0){o.removeClass("pdp-pdb-control-active")}});k.val("");b([{attr:this.id,oper:"eq",val:h}])}else{if($(".pdp-selected-criteria",o).length===0){o.removeClass("pdp-pdb-control-active")}}});var j=Azavea.tryCatch("get select options",function(q){var r='<option value="">- - All - -</option>',t={},p=[],s;q.Values.sort(c);$.each(q.Values,function(u,v){if(v.Group){if(t[v.Group]){t[v.Group].push(v.Value)}else{t[v.Group]=[v.Value];p.push(v.Group)}}else{r+='<option value="'+v.Value+'">'+v.Value+"</option>"}});if(p.length){p.sort();$.each(p,function(u,w){r+='<optgroup label="'+w+'">';var v;for(v=0;v<t[w].length;v++){r+='<option value="'+t[w][v]+'">'+t[w][v]+"</option>"}r+="</optgroup>"})}return r});var g=j(m);k.append(g).change(n);o.append(k).appendTo(i);e(function(){if($(".ui-icon",o).length>0){$(".ui-icon",o).click();k.val("").change()}})}),autocomplete:Azavea.tryCatch("",function(i,k){var r=f(k.UID,k.QueryName||k.Name,k.Desc),g=[],p=false,j=false,h=[];var o=$('<input id="'+k.UID+'" class="pdp-input pdp-control-autocomplete" type="text" />');$.expr[":"].textEquals=function(t,u,s){return $(t).text().match("^"+s[3]+"$")};var l=Azavea.tryCatch("autocomplete control close",function(s,t){if(j){o.val("");j=false}});var n=Azavea.tryCatch("autocomplete control select",function(s,t){p=true;o.removeClass("input-invalid");q(t.item.value)});var m=Azavea.tryCatch("autocomplete control change",function(s,t){o.removeClass("input-invalid");if(!p){if($(".ui-autocomplete li:textEquals('"+o.val()+"')").size()===0&&(o.val()||o.val()===0)){o.addClass("input-invalid")}q(this.value)}p=false});var q=Azavea.tryCatch("control value changed",function(t){if(t&&!o.hasClass("input-invalid")){r.addClass("pdp-pdb-control-active");var s=$('<div class="pdp-selected-criteria"><span title="Remove this filter" class="ui-icon ui-icon-close left"></span><label title="'+t+'">'+t+"</label></div>").insertBefore(o);h.push(t);$(".ui-icon",s).click(function(v){var u=$("label",s).text();$.each(h,function(w,x){if(x===u){h.splice(w,1);return false}});s.remove();b([{attr:k.UID,oper:"eq",val:h}]);if($(".pdp-selected-criteria",r).length===0){r.removeClass("pdp-pdb-control-active")}});o.val("");j=true;b([{attr:k.UID,oper:"eq",val:h}])}else{if($(".pdp-selected-criteria",r).length===0){r.removeClass("pdp-pdb-control-active")}t=""}});$.each(k.Values,function(t,s){g.push(s.Value)});o.autocomplete({source:g,change:m,select:n,close:l,minLength:2});i.append(r.append(o));e(function(){if($(".ui-icon",r).length>0){$(".ui-icon",r).click();o.val("")}})}),range:Azavea.tryCatch("creating range control",function(g,n){var t=f(n.UID,n.QueryName||n.Name,n.Desc),m="No Min",i="No Max",s,l;var j=$('<input type="text" class="pdp-input pdp-input-uninit pdp-control-range pdp-control-range-lower" id="l'+n.UID+'" value="No Min"/>');var r=$('<input type="text" class="pdp-input pdp-input-uninit pdp-control-range pdp-control-range-upper" id="u'+n.UID+'" value="No Max"/>');var p=Azavea.tryCatch("range values changed",function(x){var y=false,w=false,u,v;$(this).blur();if(!j.hasClass("pdp-input-uninit")){y=true}if(!r.hasClass("pdp-input-uninit")){w=true}if((!w&&(j.val()||j.val()==="0")&&y)||(!y&&(r.val()||r.val()==="0")&&w)||((j.val()||j.val()==="0")&&y)&&((r.val()||r.val()==="0")&&w)){v=$(".ui-icon-close",s);u=$(".ui-icon-close",l);if(y&&v.length===0){j.before('<span class="ui-icon ui-icon-close left" title="Remove this filter"></span>').addClass("pdp-pdb-control-input-range-clearable");v=$(".ui-icon-close",s);v.click(function(z){j.val("").change()})}else{if(!y&&v.length>0){v.remove();j.removeClass("pdp-pdb-control-input-range-clearable")}}if(w&&u.length===0){r.before('<span class="ui-icon ui-icon-close left" title="Remove this filter"></span>').addClass("pdp-pdb-control-input-range-clearable");u=$(".ui-icon-close",l);u.click(function(z){r.val("").change()})}else{if(!w&&u.length>0){u.remove();r.removeClass("pdp-pdb-control-input-range-clearable")}}q();$(this).focus()}else{$(".ui-icon-close",t).remove();r.removeClass("pdp-pdb-control-input-range-clearable");j.removeClass("pdp-pdb-control-input-range-clearable");h()}});var o=Azavea.tryCatch("range input focus",function(v){var u=$(this);if(u.hasClass("pdp-input-uninit")){u.removeClass("pdp-input-uninit").val("")}});var k=Azavea.tryCatch("range input blur",function(v){var u=$(this),w=i;if(u.hasClass("pdp-control-range-lower")){w=m}if(!u.val()||u.val()===w){u.addClass("pdp-input-uninit").val(w);u.removeClass("input-invalid")}});var h=Azavea.tryCatch("trigger invalid criteria",function(){if(t.hasClass("pdp-pdb-control-active")){b([{attr:n.UID,oper:"le",val:null}]);b([{attr:n.UID,oper:"ge",val:null}])}t.removeClass("pdp-pdb-control-active");$(".ui-icon-close",t).remove();r.removeClass("pdp-pdb-control-input-range-clearable");j.removeClass("pdp-pdb-control-input-range-clearable")});var q=Azavea.tryCatch("lower bound range changed",function(y){var u=[],z=false,x=false;if(!j.hasClass("pdp-input-uninit")){z=true}if(!r.hasClass("pdp-input-uninit")){x=true}if(z&&x){u.push({id:"u"+n.UID,required:false,validator:"rangeUpper"});u.push({id:"l"+n.UID,required:false,validator:"rangeLower"});u.push({id:"l"+n.UID,required:false,validator:"range"});u.push({id:"u"+n.UID,required:false,validator:"range"})}else{if(z){u.push({id:"l"+n.UID,required:false,validator:"range"})}else{if(x){u.push({id:"u"+n.UID,required:false,validator:"range"})}}}var v=j.val().replace(/[$,]/g,""),w=r.val().replace(/[$,]/g,"");if(d.Form.validate(u,{lower:v,upper:w,min:parseFloat(n.Min),max:parseFloat(n.Max)})){t.addClass("pdp-pdb-control-active");j.removeClass("input-invalid");r.removeClass("input-invalid");if(z){b([{attr:n.UID,oper:"ge",val:v}])}else{b([{attr:n.UID,oper:"ge",val:null}])}if(x){b([{attr:n.UID,oper:"le",val:w}])}else{b([{attr:n.UID,oper:"le",val:null}])}}else{h()}if(parseFloat(w)){r.val(d.Util.renderers[n.ValType](w))}if(parseFloat(v)){j.val(d.Util.renderers[n.ValType](v))}});j.blur(k).change(p).focus(o);r.blur(k).change(p).focus(o);t.append('<span class="pdp-pdb-control-range-text">Between</span><div class="pdp-pdb-control-lower pdp-pdb-control-input-range"></div><span class="pdp-pdb-control-range-text">and</span><div class="pdp-pdb-control-upper pdp-pdb-control-input-range"></div>').appendTo(g);s=$(".pdp-pdb-control-lower",t).append(j);l=$(".pdp-pdb-control-upper",t).append(r);e(function(){if(j.val()){j.val(m).addClass("pdp-input-uninit").removeClass("input-invalid")}if(r.val()){r.val(i).addClass("pdp-input-uninit").removeClass("input-invalid")}h()})}),wildcard:function(h,g){PDP.Widget.PdbControls.free(h,g,"lk")},free:Azavea.tryCatch("creating freetext control",function(h,g,i){var k=f(g.UID,g.QueryName||g.Name,g.Desc),m=$('<input id="'+g.UID+'" type="text" class="pdp-input pdp-control-free" />'),l=i?i:"eq";var j=Azavea.tryCatch("free text control changed",function(o){var n=true,p;m.removeClass("input-invalid");if(n&&m.val()){m.val(d.Util.renderers[g.ValType](m.val()));k.addClass("pdp-pdb-control-active");b([{attr:g.UID,oper:l,val:m.val()}]);p=$(".ui-icon-close",k);if(p.length===0){m.before('<span class="ui-icon ui-icon-close left" title="Remove this filter"></span>');p=$(".ui-icon-close",k);p.click(function(q){m.val("").change()})}}else{$(".ui-icon-close",k).remove();if(k.hasClass("pdp-pdb-control-active")){k.removeClass("pdp-pdb-control-active");b([{attr:g.UID,oper:l,val:null}])}}});m.change(j);k.append('<div class="pdp-pdb-control-input"></div>').appendTo(h);$(".pdp-pdb-control-input",k).append(m);e(function(){if(m.val()){m.val("");j()}})})}}(PDP));(function(a){a.Widget.Export=function(f){var c={},b=$.extend({target:"body",bindTo:a,defaultText:"Export To CSV"},f),d={},e={};c.init=Azavea.tryCatch("init app",function(){var g={},h;h=$(b.target).append('<div class="pdp-export-link"><img class="pdp-export-image" src="client/css/images/export-icon.png"/><a id="pdp-export" href="javascript:void(0)">'+b.defaultText+"</a>").hide();g=$("#pdp-export",b.target);g.click(function(){$(b.bindTo).trigger("pdp-export-request")});$(b.bindTo).bind("pdp-data-response",function(){h.show()});$(b.bindTo).bind("pdp-criteria-reset",function(){h.hide()});return c});return c}}(PDP));(function(a){a.Widget.Longview=function(q){var m={},o=$.extend({bindTo:a.Pdb,hideNoValues:false,resizable:false,modal:true,height:750,width:750,title:"Property Description",linkText:"Download Full Report"},q),e={},n,h,l,f;var i=Azavea.tryCatch("display no street view data",function(){l.empty().html('<div class="pdp-longview-street-none">No image available for this location.</div>')});var g=Azavea.tryCatch("download full longview report",function(r){a.Util.trackMetric(f,"Properties | Detailed Report Download");a.Data.getPropertyReport(r)});var c=Azavea.tryCatch("show long view details window",function(B,t){var s="",y="",C,D="",w=0,x=0,z=true,r=-1,u=$("#pdp-download-report"),A;$.each(B,function(E,v){z=true;if(v.UID==="PropertyName"){D=t[E]?t[E]:"";z=false}if(v.UID==="Lat"){w=t[E]}if(v.UID==="Lon"){x=t[E]}if(v.UID==="UID"){r=t[E]}if(z&&v.LongOrder&&(o.hideNoValues?t[E]||t[E]===0:true)){y='<label class="pdp-longview-label">'+v.Name+":</label>";if($.isArray(t[E])){A=t[E].join(", ")}else{if(a.Util.renderers[v.ValType]){A=a.Util.renderers[v.ValType](t[E])}else{A=t[E]}}s+="<tr><td>"+y+'</td><td><div class="pdp-longview-value">'+A+"</div></td></tr>"}});a.Util.trackMetric(f,"Properties | Display Longview");if(r===-1){$(u,e).hide()}else{a.Data.checkPropertyReportExists(r,function(v){if(v.Exists){$(u,e).unbind("click").click(function(){g(r)}).show()}else{u.hide()}})}C=$("#pdp-longview-table",e).empty().append(s);$("tr:odd",C).addClass("pdp-table-row-alt-pdb");$(".pdp-longview-caption",e).empty().append("<span>"+D+"</span>");if(w&&x){j(w,x)}else{i()}e.dialog("open")});var p=Azavea.tryCatch("compute streetview angle",function(s,w){var x=57.2957795;var u=0.017453;var t=s.lat()-w.lat();var r=s.lng()-w.lng();var v=Math.atan2(r*Math.cos(s.lat()*u),t)*x;return d(v)});var d=Azavea.tryCatch("compute wrap angle yaw",function(r){if(r>=360){r-=360}else{if(r<0){r+=360}}return r});var k=Azavea.tryCatch("set user role nychanis",function(r){if(r){if(r.Admin||r.Limited){f="Agency";return}}f="Public"});var j=Azavea.tryCatch("get street view data",function(u,r){try{if(!h){h=new google.maps.StreetViewService()}var t=new google.maps.LatLng(u.toFixed(6),r.toFixed(6));n=new google.maps.StreetViewPanorama(l.get(0));n.enableCloseButton=false;n.linksControl=false;h.getPanoramaByLocation(t,50,function(x,v){if(v===google.maps.StreetViewStatus.OK){l.show();var y=p(t,x.location.latLng);var w=x.location.pano;n.setPano(w);n.setPov({heading:y,pitch:0,zoom:1});n.setVisible(true)}else{i()}})}catch(s){i()}});var b=Azavea.tryCatch("create dialog container",function(){e=$('<div class="pdp-longview"><div class="pdp-longview-caption"></div><table id="pdp-longview-table" class="pdp-longview-list"></table><div id="pdp-streetview-title">Approximate View</div><div class="pdp-longview-street"></div></div>');l=$(".pdp-longview-street",e);e.append('<a id="pdp-download-report" style="display=none;" href="javascript:void(0)">'+o.linkText+"</a>");e.dialog({autoOpen:false,resizable:o.resizable,height:o.height,width:o.width,modal:o.modal,title:o.title,buttons:{Close:function(){$(this).dialog("close")}}});$("button",e).addClass("pdp-button")});a.Util.renderers.propertyDetails=function(t,u,r,s){$(".pdp-property-details-"+u).die().live("click",function(v){c(s,r)});return'<a class="pdp-property-details-'+u+'" href="javascript:void(0);">'+t+"</a>"};m.init=Azavea.tryCatch("init longview widget",function(){$(a).bind("pdp-login-status-refresh",function(s,r){k(r)});$(a).bind("pdp-login-success",function(s,r){k(r)});b();$(o.bindTo).bind("pdp-pdb-show-longview",function(t,r,s){c(s,r)});return m});return m}}(PDP));(function(a){a.Widget.Map=function(k){var n={},x=$.extend({target:"map",bindTo:a,layers:[new OpenLayers.Layer.Google("Street",{numZoomLevels:20}),new OpenLayers.Layer.Google("Satellite",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:22}),new OpenLayers.Layer.Google("Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:20}),new OpenLayers.Layer.Google("Terrain",{type:google.maps.MapTypeId.TERRAIN})],defaultBbox:new OpenLayers.Bounds(-8266466,4936833,-8204248,5000206),maxBbox:new OpenLayers.Bounds(-8306466,4896833,-8164248,5040206)},k),g,c,f,m,A,E,v,w,F=new OpenLayers.Projection("EPSG:4326"),b=-1,d=false,l,D;var I=Azavea.tryCatch("base layer changed",function(L,K){var M=c.getLayersByName(K);if(M.length){c.setBaseLayer(M[0]);a.Util.trackMetric("Map","Base Layer Change",K)}else{a.Util.quickError("Could not switch to base layer: ["+K+"], does not exist in map.")}});var u=Azavea.tryCatch("add nychanis layer",function(L,K){if(L.MapInfo&&L.MapInfo.Layers&&L.MapInfo.Layers.length&&L.MapInfo.Layers.length>K){if(A){A.mergeNewParams(L.MapInfo.Layers[K].Config)}else{A=new OpenLayers.Layer.WMS("nychanis",L.MapInfo.Server,L.MapInfo.Layers[K].Config,{isBaseLayer:false,tileSize:new OpenLayers.Size(500,500),buffer:0,displayOutsideMaxExtent:true});c.addLayer(A);if(E){c.raiseLayer(E,50)}}}else{if(A){c.removeLayer(A);A=null}}});var o=Azavea.tryCatch("nychanis layer changed",function(M,L,K){u(L,K)});var z=Azavea.tryCatch("change outline layer",function(L){var K=a.Config.Outlines.Layers[L];if(K){v.mergeNewParams(K.Config);if(!v.getVisibility()){v.setVisibility(true)}}else{v.setVisibility(false)}});var t=Azavea.tryCatch("outline layer changed",function(L,K){z(K)});var G=Azavea.tryCatch("remove popup",function(){if(w){c.removePopup(w)}});var e=Azavea.tryCatch("render popup zoom",function(L,K){$('<button id="pdp-map-popup-zoom-button" class="pdp-button left">Zoom Here</button>').button().appendTo(K).click(function(){d=true;G();c.setCenter(L,(c.getZoom()+3))})});var H=Azavea.tryCatch("render popup pager",function(R,L,N){var Q=1,P=N?" of first ":" of ";if(d&&D[b]){Q=D[b]+1}function K(S,T){if(Q>R){Q=1}if(Q<1){Q=R}b=l[Q-1];$(".pdp-shortview-property").hide();$("#pdp-popup-property-"+Q).show();$(".pdp-map-popup-pager-summary").text(Q+P+R+" Properties")}if(R>1){L.append('<div class="ui-corner-all pdp-map-popup-prev" title="View Previous Property"><span class="ui-icon ui-icon-triangle-1-w"></span></div><div class="ui-corner-all pdp-map-popup-next" title="View Next Property"><span class="ui-icon ui-icon-triangle-1-e"></span></div><div class="ui-widget-content ui-corner-all pdp-map-popup-pager-summary">'+Q+P+R+" Properties</div>").show();var M=$(".pdp-map-popup-next",L),O=$(".pdp-map-popup-prev",L);M.click(function(){Q++;K(M,O)});O.click(function(){Q--;K(M,O)})}else{L.hide()}});var q=Azavea.tryCatch("render popup contents",function(R,N,L){var M,P,Q,S,K,O;L.empty();l=[];D={};$(".olPopupCloseBox").html('<span class="ui-icon ui-icon-circle-close"></span>').click(function(){d=false;b=-1});$.each(N.Values,function(U,T){O=$('<div id="pdp-popup-property-'+(U+1)+'" class="pdp-shortview-property"><div class="pdp-shortview-caption"></div><ul class="pdp-shortview-list"></ul><div class="pdp-shortview-link"></div></div>');M="";K=T[R];l.push(K);D[K]=U;$.each(N.Attrs,function(W,V){show=true;if(V.Name==="Property Name"){S=T[W]||""}else{if(V.ShortOrder&&(x.hideNoValues?(T[W]||T[W]===0):true)){P='<label class="pdp-shortview-label">'+V.Name+":</label>";Q='<label class="pdp-shortview-value">'+a.Util.renderers[V.ValType](T[W])+"</label>";M+='<li class="pdp-shortview-list-item">'+P+Q+"</li>"}}});$(".pdp-shortview-list",O).empty().append(M);$(".pdp-shortview-caption",O).html(S);$(".pdp-shortview-link",O).html('<a class="pdp-property-details-'+K+'" href="javascript:void(0);">More Details</a>').click(function(){$(a.Pdb).trigger("pdp-pdb-show-longview",[T,N.Attrs])});if(U>0){O.hide()}else{if(b===-1){b=K}}if(d&&K===b){$(".pdp-shortview-property").hide();O.show()}L.append(O)})});var j=Azavea.tryCatch("add popup",function(L,N){var K=100,P=(N.length>K),M;if(P){M=N.slice(0,K).join(",")}else{M=N.join(",")}G(w);var O='<div class="pdp-map-popup-pager"></div><div id="pdp-map-popup-container">Loading...</div><div class="pdp-map-popup-footer"><div class="pdp-map-popup-zoom"></div></div>';a.Util.trackMetric("Map","Click Marker",N.length>1?"Cluster":"Single",N?N.length:1);w=new OpenLayers.Popup.FramedCloud("pdb-popup",L.lonlat,new OpenLayers.Size(200,200),O,null,true);c.addPopup(w,true);a.Data.getPropertyDetails(M,function(Q){var R=a.Util.getAttrIndex(Q.Attrs,"UID");q(R,Q,$("#pdp-map-popup-container"));H(Q.Values.length,$(".pdp-map-popup-pager"),P);e(L.lonlat,$(".pdp-map-popup-zoom"));d=false})});var B=Azavea.tryCatch("add marker",function(O){var L="http://www.furmancenter.org/tweaks/map-indicator.png";var M=new OpenLayers.Size(24,24);var P=new OpenLayers.Pixel(-(M.w/2),-M.h);var N=new OpenLayers.Icon(L,M,P);var K=new OpenLayers.Marker(new OpenLayers.LonLat(O.X,O.Y),N);K.events.register("click",K,function(){j(K,[O.Key])});E.addMarker(K);if(d===true&&b===O.Key){j(K,[O.Key])}$("#"+N.imageDiv.id).addClass("pdp-map-icon")});var y=Azavea.tryCatch("add cluster marker",function(P){var M=22+Math.floor((Math.log(P.Keys.length)*2)+Math.log(P.Keys.length/10)*5);var O="client/css/images/markers/marker-cluster-bg.png";var R=new OpenLayers.Size(1,1);var K=new OpenLayers.Pixel(-(M/2),-(M/2));var N=new OpenLayers.Icon(O,R,K);var L=new OpenLayers.Marker(new OpenLayers.LonLat(P.X,P.Y),N);L.events.register("click",L,function(){j(L,P.Keys)});E.addMarker(L);if(d===true){if($.inArray(b,P.Keys)>-1){j(L,P.Keys)}}var S={opacity:0.9,height:M,width:M,lineHeight:M+"px","-moz-border-radius":M+"px","-webkit-border-radius":M+"px"};var Q=$("#"+N.imageDiv.id).css("width",M).addClass("pdp-map-aggregated-icon").attr("rel",P.Keys.join(","));$("img",Q).css({width:M+"px",height:M+"px"});$('<span class="pdp-map-marker-aggregated-label">'+P.Keys.length+"</span>").css(S).appendTo(Q)});var r=Azavea.tryCatch("handle pdb map response",function(L,M){E.clearMarkers();G();var K;if(M.Singles){for(K=0;K<M.Singles.length;K++){B(M.Singles[K])}}if(M.Clusters){for(K=0;K<M.Clusters.length;K++){y(M.Clusters[K])}}});var C=Azavea.tryCatch("Zoom to a specific region of the map",function(P,R,K,M,Q,N,L){var O=new OpenLayers.Bounds(R,K,M,Q);O.transform(F,c.getProjectionObject());if(N&&L){m={x:N,y:L}}c.zoomToExtent(O,true)});var s=Azavea.tryCatch("flash map point",function(K){if(m){setTimeout(function(){var L=new OpenLayers.LonLat(m.x,m.y);L.transform(F,c.getProjectionObject());var M=c.getPixelFromLonLat(L);f.css("left",M.x).css("top",M.y).show().effect("puff");m=null},500)}});var i=Azavea.tryCatch("pdb data request",function(K){var L=c.getExtent();$(a.Pdb).trigger("pdp-map-data-request",[L.left,L.bottom,L.right,L.top])});var h=Azavea.tryCatch("on moveend",Azavea.doLast(200,function(K){i(K);s(K);d=true}));var J=Azavea.tryCatch("bind map events",function(){$(x.bindTo).bind("pdp-map-base-layer-changed",I);$(a.Nychanis).bind("pdp-nychanis-layer-change",o);$(x.bindTo).bind("pdp-map-outline-layer-changed",t);$(x.bindTo).bind("pdp-map-zoom-to",C);$(a.Pdb).bind("pdp-map-data-response",r);$(a.Pdb).bind("pdp-data-force-update",i);$(a.Pdb).bind("pdp-pdb-layer-toggle",function(L,K){a.Util.trackMetric("Map","Property Markers",K?"Display":"Hide");E.setVisibility(K)});$(a.Nychanis).bind("pdp-nyc-layer-toggle",function(L,K){if(A){a.Util.trackMetric("Map","Nychanis Layer",K?"Display":"Hide");A.setVisibility(K)}});$(a.Pdb).bind("pdp-criteria-reset",function(K){E.clearMarkers();b=-1;G()});$(a.Nychanis).bind("pdp-criteria-reset",function(K){if(A){c.removeLayer(A)}A=null});c.events.register("moveend",c,h)});var p=Azavea.tryCatch("render map",function(){g=$(x.target);f=$('<div id="pdp-map-flash-point"/>').appendTo(g).hide();c=new OpenLayers.Map(g[0].id,{projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",maxZoomLevel:17,minZoomLevel:9,maxExtent:x.defaultBbox,restrictedExtent:x.maxBbox,controls:[new OpenLayers.Control.PanPanel(),new OpenLayers.Control.ZoomPanel(),new OpenLayers.Control.Navigation(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution(),new OpenLayers.Control.ScaleLine()]});c.addLayers(x.layers);v=new OpenLayers.Layer.WMS("outlines",a.Config.Outlines.Server,{},{isBaseLayer:false,tileSize:new OpenLayers.Size(500,500),buffer:0,displayOutsideMaxExtent:true});v.setVisibility(false);c.addLayer(v);E=new OpenLayers.Layer.Markers("pdb");c.addLayer(E);c.zoomToExtent(x.defaultBbox,true)});n.init=Azavea.tryCatch("init map and related controls",function(){p();J();a.Widget.Map.Layers({target:"#pdp-map-layers-content"}).init();a.Widget.Map.Geocode({target:"#pdp-map-geocode-content"}).init();$(a).trigger("pdp-map-max-bbox",[x.maxBbox.toArray()]);return n});return n}}(PDP));(function(a){a.Widget.Map.Layers=function(c){var e={},r=$.extend({target:"maplayer",bindTo:a},c),t,s,j,d,n,w,x,f,q;var u=Azavea.tryCatch("get most recent available time",function(){var z;for(z=x.length-1;z>-1;z--){if(x[z]){f=z;break}}});var b=Azavea.tryCatch("slider changed",function(z){$(a.Nychanis).trigger("pdp-nychanis-layer-change",[t,z,x[z]])});var p=Azavea.tryCatch("slider moved",function(z){w.text("Displaying results from: "+x[z])});var l=Azavea.tryCatch("layer change click",function(A){var z=$('input[name="pdp-map-layers-buttons"]:checked').val();$(r.bindTo).trigger("pdp-map-base-layer-changed",[z])});var v=Azavea.tryCatch("panel mousedown",function(z){z.stopPropagation()});var o=Azavea.tryCatch("toggle map layer panel",function(z){if(j.is(":visible")){$(".pdp-closable-panel").hide()}else{$(".pdp-closable-panel").hide();j.show()}});var m=Azavea.tryCatch("render legend",function(){var z='<div id="pdp-nychanis-map-legend">';$.each(t.LegendInfo.Elements,function(E,J){var I=J.Color;var F=parseInt(I.substring(1,3),16);var K=parseInt(I.substring(3,5),16);var B=parseInt(I.substring(5),16);var G=t.LegendInfo.Opacity;if(!G){G="1.0"}var D=J.MinValue;var A=J.MaxValue;if(t.LegendInfo.ValueType){var H=a.Util.renderers[t.LegendInfo.ValueType];if(H){D=H(D);A=H(A)}else{A+=" (unable to render type "+t.LegendInfo.ValueType+")"}}var C="background: rgb("+F+","+K+","+B+");background: rgba("+F+","+K+","+B+","+G+");";z+='<div class="pdp-nychanis-legend-row"><span class="pdp-nychanis-legend-swatch" style="'+C+'"/><span class="pdp-nychanis-legend-info pdp-nychanis-legend-info-min">'+D+'</span><span class="pdp-nychanis-legend-info pdp-nychanis-legend-info-sep">-</span><span class="pdp-nychanis-legend-info pdp-nychanis-legend-info-max">'+A+"</span></div>"});z+="<div>";$("#pdp-nychanis-legend-container").empty().append(z)});var g=Azavea.tryCatch("render legend",function(){w.text("Displaying results from: "+x[f]);n.slider("option",{max:f,min:0,value:f,disabled:false});a.Util.renderers.sliderTicks(n,x);q.show()});var i=Azavea.tryCatch("handle nychanis data",function(A,B){t=B;if(B.MapInfo&&B.MapInfo.Layers&&B.MapInfo.Layers.length){x=[];f=null;var z;$("#pdp-map-layers-show-nyc").attr("checked",true);$("#pdp-nyc-map-title").show();$(a.Nychanis).trigger("pdp-nyc-layer-toggle",true);for(z=0;z<t.MapInfo.Layers.length;z++){if(t.MapInfo.Layers[z].Config){x.push(t.MapInfo.Layers[z].Name)}else{x.push(null)}}u();m();g();$(a.Nychanis).trigger("pdp-nychanis-layer-change",[t,f,x[f]])}else{q.hide();$(a.Nychanis).trigger("pdp-nychanis-layer-change",[t,-1,""])}});var y=Azavea.tryCatch("bind map layer events",function(){s.click(o);s.mousedown(v).dblclick(v);j.mousedown(v).dblclick(v);d.change(l);$("#pdp-map-layers-show-pdb").click(function(){if(this.checked){$("#pdp-pdb-map-title").show()}else{$("#pdp-pdb-map-title").hide()}$(a.Pdb).trigger("pdp-pdb-layer-toggle",[this.checked])});$("#pdp-map-layers-show-nyc").click(function(){if(this.checked){$("#pdp-nychanis-map-title").show()}else{$("#pdp-nychanis-map-title").hide()}$(a.Nychanis).trigger("pdp-nyc-layer-toggle",[this.checked])});$(a.Nychanis).bind("pdp-data-response",i);$(a.Pdb).bind("pdp-data-response",function(){$("#pdp-map-layers-show-pdb").attr("checked",true);$("#pdp-pdb-map-title").show();$(a.Pdb).trigger("pdp-pdb-layer-toggle",true)});$(a.Nychanis).bind("pdp-criteria-reset",function(){if(q){q.hide()}})});var k=Azavea.tryCatch("append static layers to map layer widget",function(){var A=$("#pdp-map-layers-outlines");$('<label for="pdp-map-layers-outlines-select" class="pdp-map-layers-label">Municipal Boundaries</label>').appendTo(A);var z=$('<select id="pdp-map-layers-outlines-select"/>').appendTo(A);$('<option value="none">-- None --</option>').appendTo(z);$.each(a.Config.Outlines.Layers,function(B,C){$('<option value="'+B+'">'+C.Name+"</option>").appendTo(z)});z.change(function(){$(r.bindTo).trigger("pdp-map-outline-layer-changed",z.val())})});var h=Azavea.tryCatch("render map layer widget",function(){$('<button id="pdp-map-layers" class="pdp-closable-panel-button pdp-shadow-drop">Legend</button><div id="pdp-map-layers-panel" class="pdp-closable-panel pdp-shadow-drop"><div id="pdp-map-layers-panel-buttonset" class="pdp-map-layers-section"><input id="pdp-map-layers-street" name="pdp-map-layers-buttons" class="pdp-map-layer-button" value="Street" type="radio" checked="checked"/><label for="pdp-map-layers-street">Street</label><input id="pdp-map-layers-hybrid" name="pdp-map-layers-buttons" class="pdp-map-layer-button" value="Hybrid" type="radio"/><label for="pdp-map-layers-hybrid">Hybrid</label><input id="pdp-map-layers-sat" name="pdp-map-layers-buttons" class="pdp-map-layer-button" value="Satellite" type="radio"/><label for="pdp-map-layers-sat">Satellite</label><input id="pdp-map-layers-terrain" name="pdp-map-layers-buttons" class="pdp-map-layer-button" value="Terrain" type="radio"/><label for="pdp-map-layers-terrain">Terrain</label></div><div id="pdp-map-layers-outlines" class="pdp-map-layers-section"/><div  class="pdp-map-layers-section"><input id="pdp-map-layers-show-pdb" type="checkbox" checked="checked" class="pdp-input"/><span id="pdp-pdb-map-layers-help" class="pdp-map-marker-aggregated-label" title="Property results are shown in groupings when many properties are near one another.  The number indicates how many properties are represented.">?</span><label for="pdp-map-layers-show-pdb" class="pdp-map-layers-label">Housing (SHIP) Results</label></div><div id="pdp-nychanis-results-container" class="pdp-map-layers-section"><div class="pdp-map-layers-header"><input id="pdp-map-layers-show-nyc" type="checkbox" checked="checked" class="pdp-input"/><label for="pdp-map-layers-show-nyc" class="pdp-map-layers-label">Neighborhood Info Results</label></div><div class="pdp-map-layers-content"><label id="pdp-map-layers-year-value"></label><div id="pdp-map-layers-year-slider"></div><label class="pdp-map-layers-header">Legend</label><div id="pdp-nychanis-legend-container"></div></div></div></div>').appendTo(r.target);$("#pdp-pdb-map-layers-help").tooltip({tipClass:"pdp-pdb-control-tooltip-left pdp-map-layers-tooltip",position:"center left",effect:"fade"});s=$("#pdp-map-layers").button();j=$("#pdp-map-layers-panel").hide();d=$("#pdp-map-layers-panel-buttonset").buttonset();w=$("#pdp-map-layers-year-value");q=$("#pdp-nychanis-results-container");n=$("#pdp-map-layers-year-slider").slider({range:false,disabled:true,min:1975,max:2010,value:2000,slide:function(z,A){if(x[A.value]){p(A.value)}else{return false}},change:function(z,A){b(A.value)}});k()});e.init=Azavea.tryCatch("init map layer selector widget",function(){h();y();return e});return e}}(PDP));(function(a){a.Widget.Map.Geocode=function(d){var e={},m=$.extend({target:"maplayer",bindTo:a},d),o,f,k,q,h,l,i,b,n;var s=Azavea.tryCatch("successful geocode",function(u){$(m.bindTo).trigger("pdp-map-zoom-to",[u.viewport.getSouthWest().lng(),u.viewport.getSouthWest().lat(),u.viewport.getNorthEast().lng(),u.viewport.getNorthEast().lat(),u.location.lng(),u.location.lat()]);j()});var r=Azavea.tryCatch("panel mousedown",function(u){u.stopPropagation()});var j=Azavea.tryCatch("toggle map layer panel",function(u){if(i.is(":visible")){$(".pdp-closable-panel").hide()}else{f.val("");q.hide();h.hide();$(".pdp-closable-panel").hide();i.show();f.focus()}});var c=Azavea.tryCatch("geocode an input",function(){try{if(!b){b=new google.maps.LatLngBounds(new google.maps.LatLng(40.496,-74.257),new google.maps.LatLng(40.916,-73.699))}if(!n){n=new google.maps.Geocoder()}var x=f.val();if(x==="asteroids"){var v=document.createElement("script");v.type="text/javascript";document.body.appendChild(v);v.src="http://erkie.github.com/asteroids.min.js";f.val("Thanks to Erik Rothoff Andersson!")}else{h.hide();q.hide();if(x){var u={address:x,bounds:b};n.geocode(u,p)}}}catch(w){a.Util.quickAlert("Go To Location is temporarily unavailable.")}});var p=Azavea.tryCatch("process geocode results",function(v,u){if((u===google.maps.GeocoderStatus.OK)&&v&&(v.length>0)){if(v.length===1){s(v[0].geometry)}else{l.empty();$.each(v,function(x,w){$('<li><a href="javascript:void(0);">'+w.formatted_address+"</a></li>").appendTo(l).click(function(){s(w.geometry)})});h.show()}f.val("")}else{q.show()}});var t=Azavea.tryCatch("bind map layer events",function(){o.click(j);o.mousedown(r).dblclick(r);i.mousedown(r).dblclick(r);k.click(c);f.keyup(function(u){if(u.which===13){k.click()}})});var g=Azavea.tryCatch("render map geocode widget",function(){$('<button id="pdp-map-geocode" class="pdp-closable-panel-button pdp-shadow-drop">Go To</button><div id="pdp-map-geocode-panel" class="pdp-closable-panel pdp-shadow-drop"><div id="pdp-map-geocode-panel-search" class="pdp-map-geocode-section"><label for="pdp-map-geocode-input">Address / Intersection / Place Name</label><input id="pdp-map-geocode-input" type="text"/><button id="pdp-map-geocode-submit" class="pdp-button">Go</button></div><div id="pdp-map-geocode-failure" class="ui-state-error ui-corner-all">Unable to find that location.</div><div id="pdp-map-geocode-results-container" class="pdp-map-geocode-section"><div id="pdp-map-geocode-results-header">Did you mean:</div><ul id="pdp-map-geocode-results-content"/></div></div>').appendTo(m.target);f=$("#pdp-map-geocode-input");q=$("#pdp-map-geocode-failure");k=$("#pdp-map-geocode-submit").button();h=$("#pdp-map-geocode-results-container");l=$("#pdp-map-geocode-results-content");o=$("#pdp-map-geocode").button();i=$("#pdp-map-geocode-panel").hide()});e.init=Azavea.tryCatch("init map geocoder widget",function(){g();t();return e});return e}}(PDP));(function(a){a.Widget.PdbAggregations=function(l){var i={},k=$.extend({target:"body",bindTo:a.Pdb},l),d=[],e=[],f;var j=Azavea.tryCatch("update group by list",function(m){d=[];e=[];$("input:checked","#pdp-pdb-search-counts-panel-cols").each(function(n,o){d.push($(o).attr("id"));e.push(o.value)})});var h=Azavea.tryCatch("focus details",function(){$("#pdp-pdb-search-counts").slideUp();f.hide();$(k.bindTo).trigger("pdp-pdb-aggregations-change",[[],false]);$("#pdp-pdb-button-search").button("enable")});var b=Azavea.tryCatch("focus counts",function(){var m=$("#pdp-pdb-search-counts");if(!m.is(":visible")){m.slideDown()}if(f.is(":visible")){f.hide()}else{f.show()}$(k.bindTo).trigger("pdp-pdb-aggregations-change",[d,true])});var c=Azavea.tryCatch("bind pdb aggregation events",function(){$(k.bindTo).bind("pdp-show-counts-panel",function(m){$('label[for="pdp-pdb-search-result-counts"]').click();f.show()});$(k.bindTo).bind("pdp-criteria-reset",function(m){$("input:checked","#pdp-pdb-search-counts-panel-cols").attr("checked","").removeAttr("disabled").change()});$("#pdp-pdb-search-result-type").buttonset();$('label[for="pdp-pdb-search-result-details"]').click(h);$('label[for="pdp-pdb-search-result-counts"]').click(b);$("#pdp-pdb-search-counts-change").click(function(){if(!f.is(":visible")){f.show()}else{f.hide()}});$("#pdp-pdb-search-counts-panel-close").click(function(m){f.hide()});$(document).bind("mouseup",function(m){if(!$(m.target).is("#pdp-pdb-search-counts-change")&&$(m.target).closest("#pdp-pdb-search-counts-panel").length===0){f.hide()}});$("input","#pdp-pdb-search-counts-panel-cols").change(function(n){j();$(k.bindTo).trigger("pdp-pdb-aggregations-change",[d,true]);var m=$("#pdp-pdb-search-counts-cols > strong");if(d.length){m.text(e.join(", "))}else{m.text("none selected")}if(d.length>=3){$("input:not(:checked)","#pdp-pdb-search-counts-panel-cols").attr("disabled","disabled")}else{$("input:not(:checked)","#pdp-pdb-search-counts-panel-cols").removeAttr("disabled")}})});var g=Azavea.tryCatch("render pdb counts panel",function(m){var n=Azavea.tryCatch("render pdb counts attrs",function(p,o){$.each(p,function(r,u){if(u.Attrs){var q=$('<li rel="'+u.Order+'"><div class="pdb-pdb-search-counts-category"><label class="pdb-pdb-search-counts-category-label">'+u.Name+'</label></div><ul class="pdp-pdb-search-counts-category"></ul></li>');var s=parseInt(u.Order,10)-1;var t=o.children('li[rel="'+s.toString()+'"]');if(t.length){q.insertAfter(t)}else{q.appendTo(o)}n(u.Attrs,q.children("ul.pdp-pdb-search-counts-category"));if(u.SubCats&&u.SubCats.length){n(u.SubCats,$("ul.pdp-pdb-search-counts-category",q))}}else{if(u.CanGroup){$('<li rel="'+u.CategoryOrder+'"><input type="checkbox" id="'+u.UID+'" value="'+u.Name+'"/><label for="'+u.UID+'" class="pdp-pdb-column-label">'+u.QueryName+"</label></li>").appendTo(o)}}})});$('<div id="pdp-pdb-search-result-type"><input type="radio" id="pdp-pdb-search-result-details" name="pdp-pdb-search-result-type" checked="checked" /><label for="pdp-pdb-search-result-details">Details</label><input type="radio" id="pdp-pdb-search-result-counts" name="pdp-pdb-search-result-type" /><label for="pdp-pdb-search-result-counts">Counts</label></div><div id="pdp-pdb-search-counts"><div id="pdp-pdb-search-counts-cols">Count data by (<strong>none selected</strong>)</div><a id="pdp-pdb-search-counts-change" href="javascript:void(0);">(change)</a></div><div id="pdp-pdb-search-counts-container" class="pdp-shadow-drop ui-corner-all"><div id="pdp-pdb-search-counts-panel"><div id="pdp-pdb-search-counts-panel-content"><div id="pdp-pdb-search-counts-panel-close"><span class="ui-icon ui-icon-circle-close"></span></div><p id="pdp-pdb-search-counts-caption" class="ui-corner-all ui-widget-content">Choose 1, 2 or 3 characteristics to group your filtered property results.</p><ul id="pdp-pdb-search-counts-panel-cols"></ul></div></div></div>').appendTo(k.target);n(m,$("#pdp-pdb-search-counts-panel-cols"));$("ul.pdp-pdb-search-counts-category:empty").parent().remove();f=$("#pdp-pdb-search-counts-container")});i.init=Azavea.tryCatch("init pdb aggregations",function(){$(k.bindTo).bind("pdp-pdb-attributes",function(m,n){g(n.List);c()});return i});return i}}(PDP));(function(a){a.Widget.PdbCriteria=function(m){var i={},l=$.extend({target:"body",bindTo:a.Pdb},m),b={},k=[];var f=Azavea.tryCatch("flatten attr cats",function(o){$.each(o,function(p,q){if(q.Attrs){$.each(q.Attrs,function(s,r){b[r.UID]=[r.Category];if(r.SubCat){b[r.UID].push(r.SubCat)}});if(q.SubCats&&q.SubCats.length){f(q.SubCats)}}})});var d=Azavea.tryCatch("update property criteria ui",function(){var o={};$.each(k,function(q,p){$.each(b[p.attr],function(s,r){if(o[r]){o[r]++}else{o[r]=1}})});$(".pdp-pdb-search-category-header").removeClass("pdp-pdb-control-active");$(".pdp-pdb-search-active-count").text("");$.each(o,function(p,q){$('.pdp-pdb-search-category-header-label:contains("'+p+'")').parent(".pdp-pdb-search-category-header").addClass("pdp-pdb-control-active").find(".pdp-pdb-search-active-count").text(q)})});var n=Azavea.tryCatch("update property criteria",function(r){var o=[],q=true;if(k&&k.length){$.each(k,function(s,t){if(t.attr===r.attr&&t.oper===r.oper){if((r.val&&!$.isArray(r.val))||r.val===0||($.isArray(r.val)&&r.val.length>0)){t.val=r.val;q=false}else{q=false;o.push(s)}}})}else{if(r.val||r.val===0){k.push(r);q=false}}if(q&&(r.val||r.val===0)){k.push(r)}var p;for(p=o.length-1;p>-1;p--){k.splice(o[p],1)}});var c=Azavea.tryCatch("hide levels",function(r){var p,q,o;for(p=2;p>=r;p--){q=$("#pdp-pdb-search-level-"+p);q.hide().find(".pdp-pdb-search-transparency").remove();$(".pdp-pdb-search-category-header-viewing",q).removeClass("pdp-pdb-search-category-header-viewing");if((r!==2&&p!==2)||(r===2&&p===2)){$(".pdp-pdb-search-category-header-viewing","#pdp-pdb-search-level-"+(p-1)).removeClass("pdp-pdb-search-category-header-viewing")}$("ul","#pdp-pdb-search-level-"+p).hide()}});var j=Azavea.tryCatch("update size of transparent layer",function(p,s,o){var q,r=0;p.each(function(t,u){r+=$(u).outerHeight(true)});r+=s.outerHeight(true);o.height(r+1);o.width(p.width());pos=p.position();o.css({left:pos.left,top:0})});var e=Azavea.tryCatch("bind pdb-search events",function(o){$(l.bindTo).bind("pdp-pdb-control-change",function(p,q){$.each(q,function(s,r){n(r);d()});$(l.bindTo).trigger("pdp-pdb-criteria-change",[k])});$(".pdp-pdb-search-category-header",o).click(function(q){var w=$("label",this).text(),v=$('ul[rel="'+w+'"]'),r,p=parseInt(v.parents(".pdp-pdb-search-level").attr("rel"),10),x,s,u,t=$(this);if(v.is(":visible")){c(p)}else{c(p);r=v.parents(".pdp-pdb-search-level").show();v.show();$(".pdp-pdb-search-category-title",r).text(w);t.parent().siblings().children().removeClass("pdp-pdb-search-category-header-viewing");t.addClass("pdp-pdb-search-category-header-viewing");x=$('<div class="pdp-pdb-search-transparency"></div>');s=$("div.pdp-pdb-search-category-top",r);$(l.bindTo).bind("pdp-pdb-control-change",function(y){j(v,s,x)});j(v,s,x);x.appendTo(r)}});$(a).bind("pdp-panel-close-event",function(){$(".pdp-pdb-search-category-header-viewing","#pdp-pdb-search-level-container").removeClass("pdp-pdb-search-category-header-viewing")});$(".pdp-pdb-search-category-close").click(function(p){var q=parseInt($(this).parent().parent(".pdp-pdb-search-level").attr("rel"),10);c(q)});$(l.bindTo).bind("pdp-criteria-reset",function(p){k=[];d()})});var g=Azavea.tryCatch("render pdb attributes",function(q,t,r,o){var s,p;if(q.length){s=$('[rel="'+r+'"]');if(s.length===0){s=$('<ul rel="'+(r||"")+'"></ul>').appendTo("#pdp-pdb-search-level-"+t)}$.each(q,function(x,u){if(!o){var w=u.Attrs.length;if(u.SubCats&&u.SubCats.length){w+=u.SubCats.length}o=[];o.length=w;p=false}else{p=true}var v=$('<li><div class="pdp-pdb-search-category-header"><span class="pdp-pdb-search-arrow ui-icon ui-icon-play right"></span><span class="pdp-pdb-search-active-count right"></span><label class="pdp-pdb-search-category-header-label">'+u.Name+"</label></div></li>");if(p){o[parseInt(u.Order,10)-1]={li:v,target:s}}else{v.appendTo(s)}if(u.SubCats&&u.SubCats.length){g(u.SubCats,1,u.Name,o)}var y=$('<ul rel="'+(u.Name||"")+'" class="pdp-shadow-drop"></ul>').appendTo("#pdp-pdb-search-level-"+(t+1));$.each(u.Attrs,function(A,z){var B;if(z.CanQuery){if(a.Widget.PdbControls[z.UiType]){B=$("<li></li>");if(a.Widget.PdbControls[z.UiType]){a.Widget.PdbControls[z.UiType](B,z);if(p){B.appendTo(y)}else{o[parseInt(z.CategoryOrder,10)-1]={li:B,target:y}}}else{Azavea.log("No control renderer defined for: ["+z.UiType+"].  Control ["+z.UID+"] was not rendered!")}}}});if(!p){$.each(o,function(z,A){if(A){A.li.appendTo(y)}});o=null}})}});var h=Azavea.tryCatch("render pdb criteria",function(){$('<div id="pdp-pdb-search-level-container" class="pdp-closable-panel-button"><div id="pdp-pdb-search-level-0" rel="0" class="pdp-pdb-search-level"><span class="pdp-pdb-search-category-close ui-icon ui-icon-circle-close"></span></div><div id="pdp-pdb-search-level-1" rel="1" class="pdp-pdb-search-level pdp-closable-panel"><div class="pdp-pdb-search-category-top ui-state-default"><span class="pdp-pdb-search-category-close ui-icon ui-icon-circle-close right"></span><label class="pdp-pdb-search-category-title"></label></div></div><div id="pdp-pdb-search-level-2" rel="2" class="pdp-pdb-search-level pdp-closable-panel"><div class="pdp-pdb-search-category-top ui-state-default"><span class="pdp-pdb-search-category-close ui-icon ui-icon-circle-close right"></span><label class="pdp-pdb-search-category-title"></label></div></div></div>').appendTo(l.target);g(_attributes,0);$(".pdp-pdb-search-level input, .pdp-pdb-search-level select").keyup(function(o){if(o.keyCode===13){$(l.bindTo).trigger("pdp-data-force-update");$(".pdp-closable-panel").hide()}});$(".pdp-pdb-control-label-help").tooltip({tipClass:"pdp-pdb-control-tooltip",position:"center right",offset:[-2,10],effect:"fade"})});i.init=Azavea.tryCatch("init pdb criteria",function(){$(l.bindTo).bind("pdp-pdb-attributes",function(o,p){try{_attributes=p.List;f(_attributes);h();e()}finally{$(l.bindTo).trigger("pdp-loading-finished")}});return i});return i}}(PDP));(function(a){a.Widget.NychanisIndicator=function(e){var g={},q=$.extend({target:"body",bindTo:a.Nychanis},e),u={},c={},m={},p={},n={},j={},f,o,s,t;var r=Azavea.tryCatch("trigger indicator change",function(){$(q.bindTo).trigger("pdp-nychanis-indicator-change",[u])});var v=Azavea.tryCatch("trigger indicator change",function(x){if(x||x===0){u=m[x];if(f){f.remove()}$indicatorDefaultTip.hide();f=$('<span id="pdp-nyc-indicator-help" class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span>').appendTo(o);f.attr("title",u.Description).tooltip({tipClass:"pdp-pdb-control-tooltip",position:"center right",offset:[-2,10],effect:"fade"})}else{if(f){f.remove()}$indicatorDefaultTip.show();u={}}r()});var d=Azavea.tryCatch("create select options",function(C,y,B,z){var A='<option id="" value="" selected=selected>- - '+C+"- -</option>",x;$.each(y,function(D,E){var F=z?E[z]:D;A+='<option value="'+F+'" title="'+E.Name+'">'+E.Name+"</option>"});x=$(B);x[0].options.length=0;x.empty().append(A)});var k=Azavea.tryCatch("indicator category changed",function(){if(this.value||this.value===0){d("Subcategory",c.IndCats[this.value].SubCats,"#pdp-nyc-indicator-sub-category");s.show();p.empty();o.hide()}else{s.hide();p.empty();o.hide()}v(p.val())});var i=Azavea.tryCatch("indicator sub category changed",function(){if(this.value||this.value===0){var x=n.val(),y=this.value;d("Must Choose an Indicator",c.IndCats[x].SubCats[y].Indicators,"#pdp-nyc-indicator","UID");o.show()}else{p.empty();o.hide()}v(p.val())});var b=Azavea.tryCatch("indicator changed",function(){v(this.value)});var h=Azavea.tryCatch("reset indicator values",function(){if(j){s.hide();j.empty()}if(p){p.empty();o.hide()}n.attr("selectedIndex",0);u={}});var w=Azavea.tryCatch("bind nychanis indicator events",function(){n.change(k);j.change(i);p.change(b);$(q.bindTo).bind("pdp-criteria-reset",h)});var l=Azavea.tryCatch("render nychanis indicator",function(){$('<div id="pdp-nyc-container-cat" class="pdp-nyc-indicator-selector pdp-nyc-control"><select id="pdp-nyc-indicator-category"></select><span id="pdp-nyc-help-ind-cat" title="Indicators are grouped into categories. You must select one." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span></div><div id="pdp-nyc-container-sub" class="pdp-nyc-indicator-selector pdp-nyc-control"><select id="pdp-nyc-indicator-sub-category"></select><span id="pdp-nyc-help-ind-sub" title="Categories are divided into subcategories.  You must select one." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span></div><div id="pdp-nyc-container-ind" class="pdp-nyc-indicator-selector pdp-nyc-control"><select id="pdp-nyc-indicator"></select><span id="pdp-nyc-help-ind" title="You must choose an individual indicator to display on the map or table." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span></div>').appendTo(q.target);d("Category",c.IndCats,"#pdp-nyc-indicator-category")});g.init=Azavea.tryCatch("init nychanis indicator",function(){$(q.bindTo).bind("pdp-nychanis-attributes",function(x,y){c=y;l();n=$("#pdp-nyc-indicator-category");j=$("#pdp-nyc-indicator-sub-category");p=$("#pdp-nyc-indicator");o=$("#pdp-nyc-container-ind");s=$("#pdp-nyc-container-sub");t=$("#pdp-nyc-container-cat");s.hide();o.hide();$indicatorDefaultTip=$("#pdp-nyc-help-ind");w();$.each(y.IndCats,function(A,z){$.each(z.SubCats,function(B,C){$.each(C.Indicators,function(D,E){m[E.UID]=E})})})});return g});return g}}(PDP));(function(a){a.Widget.NychanisResolution=function(f){var g={},n=$.extend({target:"body",bindTo:a.Nychanis},f),t={resolutionName:"",resolution:"",scope:"",scopeName:"",subScope:"",subScopeName:""},d={},l={},o={},c={},h={},u=-1,b=-1;var p=Azavea.tryCatch("trigger resolution change",function(){$(n.bindTo).trigger("pdp-nychanis-resolution-change",[t])});var v=Azavea.tryCatch("trigger indicator change",function(x,z,y){t.resolutionName=l[x]?l[x].Name:"";t.resolution=x;t.scope=z;if(z){t.scopeName=$("#pdp-nyc-scope :selected").text()}else{if(c&&c.is(":visible")){t.scopeName="All Boroughs"}else{t.scopeName=""}}t.subScope=y;if(y){t.subScopeName=$("#pdp-nyc-subscope :selected").text()}else{if(h&&h.is(":visible")){t.subScopeName="All Sub Boroughs"}else{t.subScopeName=""}}p()});var e=Azavea.tryCatch("create select options",function(C,y,B,z,x){var A='<option id="" value="" selected=selected>- - '+C+"- -</option>";$.each(y,function(D,E){var F=z?E[z]:D;if(!x||$.inArray(F,x)>-1){A+='<option value="'+F+'">'+E.Name+"</option>"}});$(B).empty().append(A)});var i=Azavea.tryCatch("get subboroughs",function(y){var x=[];$.each(l[b].Geographies,function(z,A){if(A.Borough===y){x.push(A)}});return x});var k=Azavea.tryCatch("reset resolution inputs",function(){v("","","","");c.hide();h.hide();o.attr("selectedIndex",0).attr("disabled",true)});var m=Azavea.tryCatch("resolution change",function(){if(this.value||this.value===0){if(l[parseInt(this.value,10)].HasBoroughData){e("All Boroughs",l[u].Geographies,"#pdp-nyc-scope","Borough");c.show();h.hide()}else{c.hide();h.hide()}}else{c.hide();h.hide()}v(this.value,"","")});var s=Azavea.tryCatch("scope resolution change",function(){if((this.value||this.value===0)&&(t.resolution||t.resolution===0)){if(l[parseInt(t.resolution,10)].HasSubBoroughData){e("All Sub Boroughs",i(this.value),"#pdp-nyc-subscope","SubBorough");h.show()}else{h.hide()}}else{h.hide()}v(t.resolution,this.value,"")});var r=Azavea.tryCatch("subscope resolution change",function(){v(t.resolution,t.scope,this.value)});var q=Azavea.tryCatch("resolution indicator change",function(y,z){if(z.AvailableYearsByResolution){var x=[];$.each(z.AvailableYearsByResolution,function(A){x.push(parseInt(A,10))});e("Select Geography Level",d.Resolutions,"#pdp-nyc-resolution","UID",x);c.hide();h.hide();o.attr("selectedIndex",0).removeAttr("disabled")}else{k()}v("","","")});var w=Azavea.tryCatch("bind nychanis resolution events",function(){$(n.bindTo).bind("pdp-nychanis-indicator-change",q);$(n.bindTo).bind("pdp-criteria-reset",k);o.attr("disabled",true).change(m);$("#pdp-nyc-scope").change(s).parent();$("#pdp-nyc-subscope").change(r).parent()});var j=Azavea.tryCatch("render nychanis resolution",function(){$('<div id="pdp-nyc-resolution-container" class="pdp-nyc-control"><select id="pdp-nyc-resolution"><option val="">-- Select --</option></select><span id="pdp-nyc-help-res" title="You must choose a geographic level to calculate your indicator.  All indicators have data for the whole city and borough.  Community districts, police precincts, school districts, subborough areas and census tracts may be available as well." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span></div><div id="pdp-nyc-scope-container" class="pdp-nyc-control"><label for"pdp-nyc-scope">But only those in</label><select id="pdp-nyc-scope"></select><span id="pdp-nyc-help-scope" title="You may choose to limit the neighborhoods on the map or table to a single borough." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span></div><div id="pdp-nyc-subscope-container" class="pdp-nyc-control"><select id="pdp-nyc-subscope"></select><span id="pdp-nyc-help-subscope" title="You may choose to limit the census tracts displayed on the map or table to a single sub-borough area." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span></div>').appendTo(n.target)});g.init=Azavea.tryCatch("init nychanis resolution",function(){$(n.bindTo).bind("pdp-nychanis-attributes",function(x,y){d=y;j();o=$("#pdp-nyc-resolution");c=$("#pdp-nyc-scope-container").hide();h=$("#pdp-nyc-subscope-container").hide();w();$.each(y.Resolutions,function(A,z){if(z.Name==="Borough"){u=z.UID}else{if(z.Name==="Subborough Area"){b=z.UID}}l[z.UID]=z;l[z.UID].GeogsByActualId={};$.each(z.Geographies,function(B,C){l[z.UID].GeogsByActualId[C.ActualId]=C})})});return g});return g}}(PDP));(function(a){a.Widget.NychanisTime=function(f){var h={},v=$.extend({target:"body",bindTo:a.Nychanis},f),B={type:"",typeName:"",minYear:"",maxYear:""},b=[{id:"pdp-nyc-result-min",required:false,validator:"number"},{id:"pdp-nyc-result-max",required:false,validator:"number"}],C={},g={},c={},t={},s={},u,z,d={},l={},i,j;var o=Azavea.tryCatch("is year in gap",function(G){var F;for(F=0;F<i.length;F++){if(G===i[F]){return false}}return true});var q=Azavea.tryCatch("change year input",function(H,G){H.val(G);var F=H.data("highlightTimeout");if(F){clearTimeout(F)}else{H.effect("highlight",{},1000)}F=setTimeout(function(){H.data("highlightTimeout",null)},500);H.data("highlightTimeout",F)});var x=Azavea.tryCatch("update year controls",function(K){function J(M,N){var L;for(L=0;L<N.length;L++){if(M===N[L]){return true}}return false}i=[];var I,H=K[0],F=K[K.length-1],G=F-H;for(I=H;I<=F;I++){if(J(I,K)){i.push(I)}else{i.push(null)}}a.Util.renderers.sliderTicks(t,i);u.val(H);z.val(F);t.slider("option","min",H);t.slider("option","max",F);t.slider("option","values",[H,F])});var w=Azavea.tryCatch("trigger time change",function(){$(v.bindTo).trigger("pdp-nychanis-time-change",[B])});var D=Azavea.tryCatch("nyc time update state",function(H,G,F){B.type=H;B.typeName=H||H===0?g[H].Name:"";B.minYear=G;B.maxYear=F;w()});var m=Azavea.tryCatch("reset resolution inputs",function(){D("","","");d.attr("disabled",true).val("");_$timeType.button("option","disabled",true);t.slider("option","disabled",true);$(".pdp-nychanis-disabled-gap",t).remove();u.val("");z.val("")});var y=Azavea.tryCatch("indicator changed",function(F,G){m();if(G.Name){C=G}else{C={}}});var r=Azavea.tryCatch("resolution changed",function(K,I){var G;var H,F;if(I.resolution||I.resolution===0){var L="",J,M;G=-1;j=parseInt(I.resolution,10);d.removeAttr("disabled");_$timeType.button("option","disabled",true);for(J in C.AvailableYearsByResolution[j]){if(J&&C.AvailableYearsByResolution[j].hasOwnProperty(J)){if(G===-1){G=parseInt(J,10)}L=c[parseInt(J,10)];$(L).button("option","disabled",false)}}if(G>-1){$(c[G]).attr("checked","checked");$(c[G]).button("refresh")}M=C.AvailableYearsByResolution[j][G];H=M[0];F=M[M.length-1];x(M);t.slider("option","disabled",false)}else{d.attr("disabled",true);_$timeType.button("option","disabled",true);t.slider("option","disabled",true);$(".pdp-nychanis-disabled-gap",t).remove()}D(G,H,F)});var A=Azavea.tryCatch("min time value changed",function(){var I=i[0],F=i[i.length-1],H=I,G=parseInt(this.value,10);if(a.Form.validate(b,{},v.target)&&(H>=I&&H<=F)){if(H<=z.val()&&!o(G)){H=G}else{q(u,I)}}else{q(u,H)}D(B.type,H,B.maxYear);t.slider("values",0,H)});var n=Azavea.tryCatch("max time value changed",function(){var I=i[0],F=i[i.length-1],H=F,G=parseInt(this.value,10);if(a.Form.validate(b,{},v.target)&&(this.value>=I&&this.value<=F)){if(this.value>=u.val()&&!o(G)){H=G}else{q(z,F)}}else{q(z,H)}D(B.type,B.minYear,H);t.slider("values",1,H)});var e=Azavea.tryCatch("slide changed",function(G,F){if(G!==parseInt(u.val(),10)){q(u,G)}if(F!==parseInt(z.val(),10)){q(z,F)}D(B.type,G,F)});var p=Azavea.tryCatch("detail time value changed",function(){var G,F=$('input[name="pdp-nyc-search-result-details"]:checked').val();G=C.AvailableYearsByResolution[j][F];x(G);D(F,B.minYear,B.maxYear)});var E=Azavea.tryCatch("bind nychanis time events",function(){$(v.bindTo).bind("pdp-nychanis-indicator-change",y);$(v.bindTo).bind("pdp-nychanis-resolution-change",r);$(v.bindTo).bind("pdp-criteria-reset",m);u.change(A);z.change(n);s.change(p)});var k=Azavea.tryCatch("render nychanis time",function(H){var G="",F=new Date();g=H.Times;$.each(H.Times,function(I,J){G+='<input id="pdp-nyc-result-type-'+J.Name+'" value="'+J.UID+'" name="pdp-nyc-search-result-details" class="pdp-nyc-time-type" type="radio"/><label for="pdp-nyc-result-type-'+J.Name+'">'+J.Name+"s</label>";c[J.UID]="#pdp-nyc-result-type-"+J.Name});$('<div id="pdp-nyc-search-result-details" class="pdp-nyc-control">'+G+'</div><div class="pdp-nyc-year-container pdp-nyc-control"><label>From</label> <input id="pdp-nyc-result-min" class="pdp-nyc-results-time-selector" type="text" size="10" value="'+B.minYear+'"/><label> to </label><input id="pdp-nyc-result-max" class="pdp-nyc-results-time-selector" type="text" size="10" value="'+B.maxYear+'"/></div><div id="pdp-nyc-result-year-slider" class="pdp-nyc-control"></div><span id="pdp-nyc-help-slider" title="This slider lets you limit which years, quarters or months will appear in the table.  You may select a different year to map on the selector above the map legend." class="ui-icon ui-icon-help pdp-nyc-control-label-help"></span>').appendTo(v.target);t=$("#pdp-nyc-result-year-slider");s=$("#pdp-nyc-search-result-details");u=$("#pdp-nyc-result-min");z=$("#pdp-nyc-result-max");d=$(".pdp-nyc-results-time-selector");_$timeType=$(".pdp-nyc-time-type");$(".pdp-nyc-control-label-help").tooltip({tipClass:"pdp-pdb-control-tooltip",position:"center right",offset:[-2,10],effect:"fade"});s.buttonset();t.slider({range:true,animate:true,min:1975,max:F.getFullYear(),values:[1975,F.getFullYear()],slide:function(I,J){if(o(J.values[0])||o(J.values[1])){return false}else{e(J.values[0],J.values[1])}}});d.attr("disabled",true);s.button("option","disabled",true);_$timeType.button("option","disabled",true);t.slider("option","disabled",true)});h.init=Azavea.tryCatch("init nychanis time",function(){$(v.bindTo).bind("pdp-nychanis-attributes",function(F,G){k(G);E()});return h});return h}}(PDP));(function(a){a.Widget.Table=function(e){var f={},n=$.extend({target:"body",bindTo:a,messageSel:"pdp-table-message",pageSizes:[20,100,500],defaultPageSize:20,pagerTarget:null,extraCols:[],altRowClass:"pdp-table-row-alt-pdb"},e),q={},m,p={colIndex:-1,sortAsc:true},k={page:1,pageSize:n.defaultPageSize,totalPages:-1},b;var o=Azavea.tryCatch("trigger table data request",function(){$(n.bindTo).trigger("pdp-data-request",[k.page,k.pageSize,p.colIndex,p.sortAsc])});f.getState=Azavea.tryCatch("get table state",function(){return{page:k.page,pageSize:k.pageSize,sortColIndex:p.colIndex,sortAsc:p.sortAsc}});f.setPage=Azavea.tryCatch("set table page",function(y,x,z){if(y>0&&y<=k.totalPages){k.page=parseInt(y,10);k.pageSize=x;if(!z){o()}}});var u=Azavea.tryCatch("refresh table pager",function(){$(n.pagerTarget).show();$(".pdp-table-pager-totalpages",n.pagerTarget||n.target).html(k.totalPages);$(".pdp-table-pager-ctrl-curpage input",n.pagerTarget||n.target).val(k.page)});var h=Azavea.tryCatch("refresh table pager",function(x){if(b){clearTimeout(b);b=0}b=setTimeout(function(){var y=$(".pdp-table-pager-ctrl-curpage input",n.pagerTarget||n.target).val();f.setPage(y,k.pageSize)},1200)});var i=Azavea.tryCatch("pager click events",function(x){var y=x.target.id;switch(y){case"pdp-table-pager-first":f.setPage(1,k.pageSize);break;case"pdp-table-pager-prev":f.setPage((k.page-1),k.pageSize);break;case"pdp-table-pager-next":f.setPage((k.page+1),k.pageSize);break;case"pdp-table-pager-last":f.setPage(k.totalPages,k.pageSize);break}});var w=Azavea.tryCatch("init table pager",function(){if($(".pdp-table-pager",n.pagerTarget||n.target).length){return}$('<div class="pdp-table-pager"><div class="pdp-table-pager-ctrl pdp-table-pager-ctrl-pagesize"><span class="pdp-table-pager-ctrl">Show:</span><select id="pdp-table-pager-ctrl-pagesize-selector"></select></div><div class="pdp-table-pager-ctrl pdp-table-pager-ctrl-first ui-corner-all pdp-border"><span id="pdp-table-pager-first" class="ui-icon ui-icon-arrowstop-1-w"></span></div><div class="pdp-table-pager-ctrl pdp-table-pager-ctrl-prev ui-corner-all pdp-border"><span id="pdp-table-pager-prev" class="ui-icon ui-icon-arrow-1-w"></span></div><div class="pdp-table-pager-ctrl pdp-table-pager-ctrl-curpage"><input id="pdp-table-pager-ctrl-curpage-input" type="text" value="0"/> of <span class="pdp-table-pager-totalpages">0</span></div><div class="pdp-table-pager-ctrl pdp-table-pager-ctrl-next ui-corner-all pdp-border"><span id="pdp-table-pager-next" class="ui-icon ui-icon-arrow-1-e"></span></div><div class="pdp-table-pager-ctrl pdp-table-pager-ctrl-last ui-corner-all pdp-border"><span id="pdp-table-pager-last" class="ui-icon ui-icon-arrowstop-1-e"></span></div></div>').appendTo(n.pagerTarget||n.target);var x="",y;for(y=0;y<n.pageSizes.length;y++){var z="";if(n.pageSizes[y]===n.defaultPageSize){z=' selected = "selected"'}x+='<option value="'+n.pageSizes[y]+'"'+z+">"+n.pageSizes[y]+"</option>"}$("#pdp-table-pager-ctrl-pagesize-selector",n.pagerTarget||n.target).append(x).change(function(A){f.setPage(1,this.value)});$("#pdp-table-pager-ctrl-curpage-input",n.pagerTarget||n.target).val(k.page).keyup(h);$(".pdp-table-pager",n.pagerTarget||n.target).click(i)});var d=Azavea.tryCatch("toggle col sorting",function(y,C){var A=q.ExtraAttrs?q.ExtraAttrs.length:0,B='<span class="pdp-table-col-sorting right ui-icon ui-icon-triangle-1-n"></span>',z='<span class="pdp-table-col-sorting right ui-icon ui-icon-triangle-1-s"></span>';if(p.colIndex===y){p.sortAsc=!p.sortAsc;var x=$("tr th:nth-child("+(p.colIndex+1+A)+")",n.target);if(p.sortAsc){x.removeClass("pdp-table-col-sortdesc").addClass("pdp-table-col-sortasc").find("span.pdp-table-col-sorting").remove();$("div.ktable-th-text",x).before(B)}else{x.removeClass("pdp-table-col-sortasc").addClass("pdp-table-col-sortdesc").find("span.pdp-table-col-sorting").remove();$("div.ktable-th-text",x).before(z)}}else{p.colIndex=y;p.sortAsc=C?true:false;$(".pdp-table-col-sortasc,.pdp-table-col-sortdesc").removeClass("pdp-table-col-sortasc pdp-table-col-sortdesc").find("span.pdp-table-col-sorting").remove();$("tr th:nth-child("+(p.colIndex+1+A)+")",n.target).addClass(C?"pdp-table-col-sortasc":"pdp-table-col-sortdesc").find("div.ktable-th-text").before(C?B:z)}o()});var t=Azavea.tryCatch("enable col resize",function(y){var z=q.ExtraAttrs?q.ExtraAttrs.length:0;var B,x,A="<colgroup>";for(B=0;B<z;B++){A+='<col class="pdp-table-col-extra"/>'}for(B=0;B<(q.Attrs.length);B++){x="";if(!m[B]){x=" pdp-table-col-hide"}A+='<col class="pdp-table-col-index-'+B+x+'"/>'}A+="</colgroup>";y.prepend(A);y.ktable_colsizable({dragMove:true,dragProxy:"area",dragOpacity:0.1})});var l=Azavea.tryCatch("refresh col visibility",function(x){$.each(m,function(z,y){if(y){$(".pdp-table-col-index-"+z,x).removeClass("pdp-table-col-hide")}else{$(".pdp-table-col-index-"+z,x).addClass("pdp-table-col-hide")}})});f.showCol=Azavea.tryCatch("show col",function(x){m[x]=true;$(".pdp-table-col-index-"+x,n.target).removeClass("pdp-table-col-hide")});f.hideCol=Azavea.tryCatch("hide col",function(x){m[x]=false;$(".pdp-table-col-index-"+x,n.target).addClass("pdp-table-col-hide")});var r=Azavea.tryCatch("get body row",function(D,x,C){var B=new a.StringBuffer(),y,z,A;B.append('<tr class="'+C+'">');if(q.ExtraAttrs){for(y=0;y<q.ExtraAttrs.length;y++){z=q.ExtraAttrs[y];B.append('<td class="');B.append(C);B.append('">');B.append(a.Util.renderers[z.ValType](z.Name,D,x,q.Attrs));B.append("</td>")}}for(y=0;y<q.Attrs.length;y++){A=x[y];z=q.Attrs[y];if(a.Util.renderers[z.ValType]){A=a.Util.renderers[z.ValType](x[y],D,x,q.Attrs)}B.append('<td class="pdp-column-render-');B.append(z.ValType);B.append(" pdp-table-col-index-");B.append(y);if(!m[y]){B.append(" pdp-table-col-hide")}B.append('">');B.append(A);B.append("</td>")}B.append("</tr>");return B.toString()});var g=Azavea.tryCatch("get table widget rows",function(C){var x=$("<tbody></tbody>"),B=new a.StringBuffer(),A,D,y,z="";if(q.ContextRows){for(A=0;A<q.ContextRows.length;A++){y=q.ContextRows[A];if(A===q.ContextRows.length-1){z=" pdp-widget-table-context-row-last"}B.append(r(y[C],y,"pdp-widget-table-context-row"+z))}}for(A=0;A<q.Values.length;A++){y=q.Values[A];D=y[C];if(!C){D=A}B.append(r(D,y,""))}x.append(B.toString());$("tr:odd",x).addClass(n.altRowClass);return x});var v=Azavea.tryCatch("render table widget table",function(){var x=$(n.target).empty(),y,z='<table class="pdp-table"><thead><tr>';if(q.ExtraAttrs){$.each(q.ExtraAttrs,function(A,B){z+='<th class="pdp-table-col-nosort">'+B.Name+"</th>"})}$.each(q.Attrs,function(C,D){var A="",B="";if(D.NotSortable){A=" pdp-table-col-nosort"}else{A=" ui-state-default"}if(!m[C]){A+=" pdp-table-col-hide"}if(D.ValType==="text"){B=" pdp-table-col-sort-invert"}z+='<th class="'+B+A+" pdp-table-col-index-"+C+'" rel="'+C+'">'+D.Name+"</th>"});z+="</tr></thead></table>";y=$(z).append(g());t(y);y.appendTo(x)});var s=Azavea.tryCatch("init col state",function(){p={colIndex:-1,sortAsc:true};m=[];$.each(q.Attrs,function(x,y){m.push(y.OnByDefault)})});var c=Azavea.tryCatch("handle col vis response",function(y,z,x){m=z;if(x||x===0){if(m[x]){f.showCol(x)}else{f.hideCol(x)}}else{l()}});var j=Azavea.tryCatch("table handle new data response",function(z,A){try{var y=Azavea.superEquals(q.Attrs,A.Attrs);q=A;k.totalPages=Math.ceil(q.TotalResults/k.pageSize);$("."+n.messageSel).remove();$(n.target).show();if(q.TotalResults>0){if(y&&$("tbody",n.target).length!==0){$("tbody",n.target).remove();var B=a.Util.getAttrIndex(q.Attrs,"UID");var x=g(B);$("table",n.target).append(x).show()}else{s();v();w()}u()}else{if(y){$("tbody",n.target).remove();$("table",n.target).hide()}else{$(n.target).empty()}u();$(n.target).append('<div class="'+n.messageSel+'">No results.</div>')}}finally{$(n.bindTo).trigger("pdp-loading-finished")}});f.init=Azavea.tryCatch("init table widget",function(){$(n.bindTo).bind("pdp-data-response",j);$(n.bindTo).bind("pdp-data-force-update",function(){p.colIndex=-1;k.page=1;o()});$(n.bindTo).bind("pdp-criteria-reset",function(){$(n.target).hide();$(n.pagerTarget).hide()});$("th:not(.pdp-table-col-nosort)",n.target).live("click",function(x){var z=$(this),y=parseInt(z.attr("rel"),10),A=z.hasClass("pdp-table-col-sort-invert");d(y,A)});$(n.bindTo).bind("pdb-column-visibility",c);return f});return f}}(PDP));(function(a){a.Pdb.Search=function(f){var d={},c=$.extend({target:"body",bindTo:a.Pdb},f),b,e;var h=Azavea.tryCatch("render pdb search",function(){$('<div id="pdp-pdb-search-criteria" class="pdp-pdb-search-container"><h4>Filter by</h4></div><div id="pdp-pdb-search-aggregations" class="pdp-pdb-search-container"><h4>Show my results as</h4></div><div class="pdp-search-actions"><button id="pdp-pdb-button-search" class="pdp-button">Submit</button><a id="pdp-pdb-button-reset" href="javascript:void(0);">Clear</a></div>').appendTo(c.target);$("#pdp-pdb-button-search").button()});var g=Azavea.tryCatch("bind pdb search events",function(){$("#pdp-pdb-button-search").click(function(){$(c.bindTo).trigger("pdp-data-force-update")});$("#pdp-pdb-button-reset").click(function(){$(c.bindTo).trigger("pdp-criteria-reset")})});d.init=Azavea.tryCatch("init pdb search",function(){h();g();b=a.Widget.PdbCriteria({target:"#pdp-pdb-search-criteria"}).init(d);e=a.Widget.PdbAggregations({target:"#pdp-pdb-search-aggregations"}).init(d);a.Data.getAttributes(function(i){$(c.bindTo).trigger("pdp-pdb-attributes",[i])});return d});return d}}(PDP));(function(a){a.Pdb.Results=function(g){var i={},s=$.extend({target:"body",bindTo:a.Pdb},g),n,r,B,q,j,p,h,t="Public",b,c,x,y,e,w,l;var d=Azavea.tryCatch("submit pdb analytics",function(H,E,K){var F,I="",C="",J="",G="",D="Properties | Search";if(E&&E.length){D="Properties | Aggregate"}for(F=0;F<H.length;F++){I=H[F].attr;J=H[F].val;switch(H[F].oper){case"eq":C="=";break;case"ge":C=">=";break;case"le":C="<=";break}G+=I+C+J+" | "}G=G.substring(0,G.length-2);if(E&&E.length){G+=" Aggregate By(";for(F=0;F<E.length;F++){G+=E[F]+", "}G=G.substring(0,G.length-2)+")"}a.Util.trackMetric(t,D,G?G:"[No Criteria]",K)});var A=Azavea.tryCatch("update pdb map title",function(D,C){if(C){var E=D===1?" SHIP property":" SHIP properties";w.hide();l.html("Displaying "+a.Util.renderers.integer(D)+E)}else{w.show();l.html(", displaying "+a.Util.renderers.integer(D)+" on the map")}});var u=Azavea.tryCatch("update pdb title",function(G,J){var D,H,K=-1,F=0,I;var E;var C;if(!G){return}if(J){E=" records";C=" SHIP properties";if(G.TotalResults===1){E=" record"}H=a.Util.renderers.integer(G.TotalResults)+E+" returned";$("#pdp-pdb-table-title").removeClass("pdp-pdb-table-title-details");w.hide()}else{$("#pdp-pdb-table-title").addClass("pdp-pdb-table-title-details");I=a.Util.renderers.integer(G.TotalResults);E=" records";C=" SHIP properties";if(G.TotalResults===1){C=" SHIP property"}H=I+C+" meet your criteria";w.show().html(H)}$("#pdp-pdb-table-uninitialized").remove();if(j&&(j.totalResults||j.totalResults===0)){A(j.totalResults,J)}y.show();e.html(H).show()});var f=Azavea.tryCatch("get pdb map data",function(M,Q,O,L,J){if(x&&c.length<1){$(s.bindTo).trigger("pdp-loading-finished");$(s.bindTo).trigger("pdp-show-counts-panel");return}if(M){var D=JSON.stringify(M);var F=L-Q;var R=J-O;if(j){if((D===j.critStr)&&(Math.abs(F-j.origWidth)<2)&&(Math.abs(R-j.origHeight)<2)&&(L<=j.maxx)&&(J<=j.maxy)&&(Q>=j.minx)&&(O>=j.miny)){return}}var P=Q-F;var N=O-R;var K=L+F;var I=J+R;var H=p[0],E=p[2],G=p[1],C=p[3];a.Data.getPropertyLocations(M,P,N,K,I,H,G,E,C,function(S){j={critStr:D,minx:P,maxx:K,miny:N,maxy:I,origHeight:R,origWidth:F,totalResults:S.TotalMapResults};A(S.TotalMapResults,x);$(s.bindTo).trigger("pdp-map-data-response",[S])},function(){$(s.bindTo).trigger("pdp-loading-finished")})}});var m=Azavea.tryCatch("get pdb data",function(H,G,F,C,D,E){if(x&&G.length<1){$(s.bindTo).trigger("pdp-loading-finished");$(s.bindTo).trigger("pdp-show-counts-panel");return}a.Data.getProperties(H,C,F,D,E,G,function(I){u(I,x);if(F===1&&D<0){d(H,G,I.TotalResults)}if(!G||G.length===0){I.ExtraAttrs=[{Name:"Details",ValType:"propertyDetails"}]}else{I.GroupByQuery=true}$(s.bindTo).trigger("pdp-data-response",[I])},function(){$(s.bindTo).trigger("pdp-loading-finished")})});var o=Azavea.tryCatch("set user role nychanis",function(C){if(C){if(C.Admin||C.Limited){t="Agency";return}}t="Public"});var z=Azavea.tryCatch("bind pdb result events",function(){$(a).bind("pdp-login-status-refresh",function(D,C){o(C)});$(a).bind("pdp-login-success",function(D,C){o(C)});$(a).bind("pdp-map-max-bbox",function(D,C){p=C});$(s.bindTo).bind("pdp-data-force-update",function(){b=$.extend(true,[],r||[]);c=$.extend(true,[],B||[]);x=h});$(s.bindTo).bind("pdp-data-request",function(F,G,C,D,E){m(b,c,G,C,D,E)});$(s.bindTo).bind("pdp-map-data-request",function(E,D,C,G,F){f(b,D,C,G,F)});$(s.bindTo).bind("pdp-pdb-criteria-change",function(C,D){r=$.extend(true,[],D||[])});$(s.bindTo).bind("pdp-pdb-aggregations-change",function(D,E,C){B=$.extend(true,[],E||[]);h=C});$(s.bindTo).bind("pdp-criteria-reset",function(){j={};b=null;y.hide().children().empty();e.empty().hide();v()});$(s.bindTo).bind("pdp-export-request",function(C){a.Util.trackMetric(t,"Properties | Export");a.Data.getPropertiesCsv(b,c)})});var v=Azavea.tryCatch("display pdb no query message",function(){if($("#pdp-pdb-table-uninitialized").length===0){$(g.tableTitleTarget).append('<div id="pdp-pdb-table-uninitialized" class="pdp-table-uninitialized"><img src="client/css/images/table-icon.png"/><div>There is no data selected to generate a table.  Please use the criteria on the left to select data for your search.</div></div>')}});var k=Azavea.tryCatch("render nychanis search",function(){y=$('<div id="pdp-pdb-map-title" class="pdp-map-title"><div id="pdp-pdb-title-count"></div><div id="pdp-pdb-title-display"></div></div>').hide().appendTo(s.mapTitleTarget);e=$('<div id="pdp-pdb-table-title" class="pdp-table-title pdp-pdb-table-title"></div>').hide().appendTo(s.tableTitleTarget)});i.init=Azavea.tryCatch("init pdb results",function(){z();k();v();w=$("#pdp-pdb-title-count");l=$("#pdp-pdb-title-display");n=a.Widget.Table({target:s.tableTarget,pagerTarget:s.tablePagerTarget,bindTo:a.Pdb,altRowClass:"pdp-table-row-alt-pdb"}).init();q=a.Widget.Longview({hideNoValues:true,modal:true,resizable:true,height:600,width:800,title:"Property Description"}).init();a.Widget.ColumnSelector({target:s.columnSelectTarget,bindTo:a.Pdb}).init();a.Widget.Export({target:s.exportTarget,bindTo:a.Pdb}).init();return i});return i}}(PDP));(function(a){a.Nychanis.Search=function(j){var f={},h=$.extend({target:"body",bindTo:a.Nychanis},j),g,d,i;var e=Azavea.tryCatch("render nychanis search",function(){$('<div id="pdp-nychanis-search-criteria" class="pdp-nychanis-search-container"><h4>Indicator<span id="pdp-nyc-help-indicator" title="An indicator provides comparable information about a specific attribute of regions of New York City.  It does not affect which properties are displayed." class="ui-icon ui-icon-help pdp-nyc-filter-tooltip"></span></h4><div id="pdp-nychanis-indicator"></div><h4>Geographic Boundary<span id="pdp-nyc-help-geo" title="You must choose geographic areas to calculate your indicator." class="ui-icon ui-icon-help pdp-nyc-filter-tooltip"></span></h4><div id="pdp-nychanis-resolution"></div></div><div id="pdp-nychanis-result-type" class="pdp-nychanis-search-container"><h4>Show my results in<span id="pdp-nyc-help-results" title="You must choose a time scale for your indicator. All indicators are available by year.  Depending on the indicator, there may be quarterly or monthly data. If you change nothing, the most recently selected time period will be mapped." class="ui-icon ui-icon-help pdp-nyc-filter-tooltip"></span></h4><div id="pdp-nychanis-time"></div></div><div class="pdp-search-actions"><button id="pdp-nychanis-button-search" class="pdp-button">Submit</button><a id="pdp-nychanis-button-reset" href="javascript:void(0);">Clear</a></div>').appendTo(h.target);i=$("#pdp-nychanis-button-search").button();$(".pdp-nyc-filter-tooltip").tooltip({tipClass:"pdp-pdb-control-tooltip",position:"center right",offset:[-2,10],effect:"fade"})});var c=Azavea.tryCatch("enable nychanis search button",function(k,l){if(l.resolutionName){i.button("option","disabled",false)}else{i.button("option","disabled",true)}});var b=Azavea.tryCatch("bind nychanis search events",function(){$("#pdp-nychanis-button-search").click(function(){$(h.bindTo).trigger("pdp-data-force-update")});$("#pdp-nychanis-button-reset").click(function(){$(h.bindTo).trigger("pdp-criteria-reset")});$(h.bindTo).bind("pdp-nychanis-resolution-change",c)});f.init=Azavea.tryCatch("init nychanis search",function(){e();b();i.button("option","disabled",true);a.Widget.NychanisIndicator({target:"#pdp-nychanis-indicator"}).init();a.Widget.NychanisResolution({target:"#pdp-nychanis-resolution"}).init();a.Widget.NychanisTime({target:"#pdp-nychanis-time"}).init();a.Data.getNychanisMeta(function(k){$(h.bindTo).trigger("pdp-nychanis-attributes",[k])});return f});return f}}(PDP));(function(a){a.Nychanis.Results=function(c){var d={},l=$.extend({target:"body",bindTo:a.Nychanis},c),s,p,h,k,j,f,m="Public";var b=Azavea.tryCatch("submit pdb analytics",function(t){var v="Nychanis | Search",u="";u="Indicator = "+k.Name;u+="| Resolution = "+j.resolutionName;if(j.scopeName){u+="| Scope = "+j.scopeName}if(j.subScopeName){u+="| Subscope = "+j.subScopeName}u+="| TimeType = "+f.typeName;u+="| MinYear = "+f.minYear;u+="| MaxYear = "+f.maxYear;a.Util.trackMetric(m,v,u,t)});var n=Azavea.tryCatch("update nychanis table layout",function(){var t=parseFloat($(c.tableTitleTarget).height());if(t===0){t=50}$(c.tableTarget).css("margin-top",t+"px");$(c.tableTarget).css("top","0px")});var o=Azavea.tryCatch("update nychanis title",function(x){var u,w,v,y,t;if(f.minYear===f.maxYear){u=" for "+f.minYear}else{u=" from "+f.minYear+" to "+f.maxYear}y=k.Name+" by "+j.resolutionName+u;w=x?" for "+x:"";v=k.Name+" by "+j.resolutionName+w;$("#pdp-nyc-table-uninitialized").remove();s.html(v).show();p.html(y).show()});var g=Azavea.tryCatch("get nychanis data",function(w,t,u,v){a.Data.getNychanis(t,w,u,v,k.UID,j.resolution,f.type,f.minYear,f.maxYear,j.scope,j.subScope,function(x){b(x.TotalResults);o();n();$(l.bindTo).trigger("pdp-data-response",[x])},function(){$(l.bindTo).trigger("pdp-loading-finished")})});var i=Azavea.tryCatch("set user role nychanis",function(t){if(t){if(t.Admin||t.Limited){m="Agency";return}}m="Public"});var r=Azavea.tryCatch("bind nychanis result events",function(){$(l.bindTo).bind("pdp-login-status-refresh",function(u,t){i(t)});$(a).bind("pdp-login-success",function(u,t){i(t)});$(l.bindTo).bind("pdp-data-request",function(w,x,t,u,v){g(x,t,u,v)});$(l.bindTo).bind("pdp-nychanis-indicator-change",function(t,u){k=u});$(l.bindTo).bind("pdp-nychanis-resolution-change",function(t,u){j=u});$(l.bindTo).bind("pdp-nychanis-time-change",function(t,u){f=u});$(l.bindTo).bind("pdp-export-request",function(t){a.Util.trackMetric(m,"Nychanis | Export");a.Data.getNychanisCsv(k.UID,j.resolution,f.type,f.minYear,f.maxYear,j.scope,j.subScope)});$(l.bindTo).bind("pdp-nychanis-layer-change",function(u,w,t,v){o(v)});$(l.bindTo).bind("pdp-criteria-reset",function(){s.hide();p.hide();q()});$(window).resize(function(){n()})});var q=Azavea.tryCatch("display pdb no query message",function(){if($("#pdp-nyc-table-uninitialized").length===0){$(c.tableTitleTarget).append('<div id="pdp-nyc-table-uninitialized" class="pdp-table-uninitialized"><img src="client/css/images/table-icon.png"/><div>There is no data selected to generate a table.  Please select an indicator to the left to view neighborhood information.</div></div>')}});var e=Azavea.tryCatch("render nychanis search",function(){s=$('<div id="pdp-nychanis-map-title" class="pdp-map-title"></div>').hide().appendTo(l.mapTitleTarget);p=$('<div id="pdp-nychanis-table-title" class="pdp-table-title"></div>').hide().appendTo(l.tableTitleTarget)});d.init=Azavea.tryCatch("init nychanis results",function(){e();r();q();h=a.Widget.Table({target:l.tableTarget,pagerTarget:l.tablePagerTarget,bindTo:a.Nychanis,altRowClass:"pdp-table-row-alt-nyc"}).init();a.Widget.Export({target:l.exportTarget,bindTo:a.Nychanis}).init();return d});return d}}(PDP));(function(a){a.Widget.LoadingIndicator=function(k){var g={},i=$.extend({target:"body",bindTo:[a,a.Nychanis,a.Pdb],delay:500},k),f,j,b;var d=Azavea.tryCatch("show loader indicator",function(){var l,m;l=$(window).width()/2;m=$(window).height()/2;f.css("top",m-f.height()/2);f.css("left",l-f.width()/2);b=setTimeout(function(){j.fadeTo("fast",0.5);f.show()},i.delay)});var h=Azavea.tryCatch("hide loader indicator",function(){clearTimeout(b);j.fadeTo("fast",0,function(){j.hide()});f.hide()});var c=Azavea.tryCatch("bind indicator events",function(){$.each(i.bindTo,function(l,m){$(m).bind("pdp-data-request",d);$(m).bind("pdp-loading-indicator-request",d);$(m).bind("pdp-loading-finished",h)})});var e=Azavea.tryCatch("render loader indicator",function(){j=$('<div id="pdp-loading-overlay"></div>');f=$('<div id="pdp-loading-indicator" class="ui-corner-all"></div>');j.hide().appendTo(i.target);f.hide().appendTo(i.target)});g.init=Azavea.tryCatch("init app",function(){e();c();f=$("#pdp-loading-indicator");return g});return g}}(PDP));(function(a){a.Widget.Splash=function(n){var k={},m=$.extend({target:"body",bindTo:a,cookieName:"pdp-ignore-splash",expireYear:2020,backgroundOpacity:0.3},n),d,e;var i=Azavea.tryCatch("update layout height",function(){var o,p;var r=$(window);o=r.width()/2;p=r.height()/2;e.css("height",r.height()-50);var q=p-e.height()/2;e.css("top",q<5?5:q);e.css("left",o-e.width()/2)});var l=Azavea.tryCatch("set splash cookie",function(){var o=new Date();o.setFullYear(m.expireYear,1,1);document.cookie=m.cookieName+"=true;expires="+o.toUTCString()});var f=Azavea.tryCatch("set splash cookie",function(){var o=new Date();o.setFullYear(o.getFullYear-1,1,1);document.cookie=m.cookieName+"=false;expires="+o.toUTCString()});var h=Azavea.tryCatch("render splash",function(){$('<div id="pdp-splash-overlay"></div><div id="pdp-splash-screen" class="ui-corner-all pdp-shadow-dark-all"><h2>Welcome to the Furman Center\'s Data Search Tool</h2><div id="pdp-splash-screen-content"><div id="pdp-splash-search-descriptions"><div><span><strong>Neighborhood Info:</strong> View or download tables and maps of historic and contemporary housing, demographic, and community information at a variety of neighborhood sizes in New York City.</span></div><div><span><strong>Affordable Housing (SHIP):</strong> View or download tables and  maps of thousands of New York City properties in the Furman Center\'s SHIP (Subsidized Housing Information Project) database.</span></div></div><table id="pdp-splash-table"><tr class="pdp-splash-image-row"><td><img width="190px" height="240px" src="client/css/images/splash/splash-nychanis.png"></td><td><img width="190px" height="240px" src="client/css/images/splash/splash-property.png"></td><tr class="pdp-splash-link-row"><td><a id="pdp-splash-nychanis" class="pdp-splash-link" href="javascript:void(0);">Neighborhood Search</a></td><td><a id="pdp-splash-property" class="pdp-splash-link" href="javascript:void(0);">Housing (SHIP) Search</a></td></table><div id="pdp-splash-search-instructions"><div>You may switch between Neighborhood Info and Housing (SHIP) using their tabs, and display both on the same map.  Choices made beneath one tab do not modify the other\'s results.</div></div></div><div id="pdp-splash-buttonbar"><div id="pdp-splash-linkbar"><a href="http://www.furmancenter.org/data/">Furman Center Data</a><a href="http://www.furmancenter.org/data/search/guide/">How-to Guide</a><a href="http://www.furmancenter.org/data/disclaimer/">Disclaimer</a></div><a id="pdp-splash-skip" href="javascript:void(0);">Skip</a><input id="pdp-splash-no-show" type="checkbox" class="pdp-input pdp-input-checkbox left"/><label for="pdp-splash-no-show" class="left">Do not show again</label></div><div id="pdp-splash-support">This site supports Firefox 3+, Internet Explorer 7+ and Chrome 4+.</div></div>').appendTo(m.target)});var g=Azavea.tryCatch("display splash screen",function(){i();$(window).resize(function(){i()});d.fadeTo("fast",m.backgroundOpacity)});var b=Azavea.tryCatch("hide splash screen",function(){d.fadeOut();e.fadeOut()});var c=Azavea.tryCatch("bind to events splash",function(){var p=$("#pdp-splash-no-show"),o=$("#pdp-splash-skip");d=$("#pdp-splash-overlay");e=$("#pdp-splash-screen");$("#pdp-splash-nychanis",e).click(function(){$('a[href="#pdp-nychanis-view"]').click();b()});$("#pdp-splash-property",e).click(function(){$('a[href="#pdp-pdb-view"]').click();b()});$("#pdp-splash-counts",e).click(function(){$("#pdp-pdb-search-result-counts").change();$(a.Pdb).trigger("pdp-show-counts-panel");b()});$(p,d).change(function(q){if(p.is(":checked")){l()}else{f()}});$(o,d).click(function(q){b()});d.keydown(function(q){if(q.keyCode===27){b()}})});var j=Azavea.tryCatch("bind to events splash",function(){var p=-1,r=0,o=0,q="";if(document.cookie.length>0){p=document.cookie.indexOf(m.cookieName+"=");if(p!==-1){r=p+m.cookieName.length+1;o=document.cookie.indexOf(";",r);if(o===-1){o=document.cookie.length}q=unescape(document.cookie.substring(r,o));if(q==="true"){return false}else{return true}}}return true});k.init=Azavea.tryCatch("init splash",function(){if(j()){h();c();g()}return k});return k}}(PDP));(function(a){a.App=function(o){var k={},m=$.extend({target:"body",bindTo:a,tabTarget:""},o),c={dataType:"pdp-pdb-view",uiType:"pdp-map-view"},d,e;var g=Azavea.tryCatch("update main content",function(){$(".pdp-main-content").hide();$("."+c.dataType+"."+c.uiType).show()});var j=Azavea.tryCatch("set data type state",function(p){d.removeClass(c.dataType).addClass(p);e.removeClass(c.dataType).addClass(p);c.dataType=p;g()});var f=Azavea.tryCatch("set ui type state",function(p){c.uiType=p;g();a.Util.trackMetric("Application","UI State",p)});var h=Azavea.tryCatch("update layout height",function(s,q,u,r){var t=q.outerHeight();var p=u.height();s.outerHeight(p-t);d.outerHeight(p-t-r.outerHeight());_$tabContent.outerHeight(p-t-r.outerHeight())});var i=Azavea.tryCatch("init layout height",function(){var p=$("#header");var r=$("#content");var q=$("#pdp-main-toolbar");var s=$(window);h(r,p,s,q);s.resize(function(){h(r,p,s,q)})});var b=Azavea.tryCatch("init layout tabs",function(){$(m.tabTarget+" .pdp-tab-content").hide();$(m.tabTarget+" .pdp-tab-content:first").show();$(m.tabTarget+" .pdp-tab:first").addClass("active");$(m.tabTarget+" .pdp-tab a").click(function(){var q=$(m.tabTarget+" .pdp-tab.active").attr("id");$(m.tabTarget+" .pdp-tab").removeClass("active");$(this).parent().addClass("active");var r=$($(this).attr("href"));var p=r.attr("id");if(q!==p){$(m.tabTarget+" .pdp-tab-content").hide();r.show();j(p)}return false})});var n=Azavea.tryCatch("init data view picker",function(){$(m.dataViewPickerTarget).buttonset();$("label",m.dataViewPickerTarget).click(function(p){f($(this).attr("for"))})});var l=Azavea.tryCatch("init no data alerts",function(){$(a.Nychanis).bind("pdp-data-response",function(p,q){if(!q.Values||!q.Values.length){a.Util.quickAlert("No results matched your search")}});$(a.Pdb).bind("pdp-data-response",function(p,q){if(!q.TotalResults){a.Util.quickAlert("No results matched your search")}})});k.getAppUrl=Azavea.tryCatch("get app url",function(){return m.appUrl});k.init=Azavea.tryCatch("init app",function(){d=$("#pdp-main");e=$("#pdp-tab-container");_$tabContent=$(".pdp-tab-content-container");a.Widget.LoadingIndicator({delay:100}).init();$(m.bindTo).trigger("pdp-loading-indicator-request");PDP.Widget.Signup({target:"#signup"}).init();PDP.Widget.Login({target:"#login",profileUrl:"user/profile.aspx",logoutUrl:"default.aspx",adminUrl:"admin/manage-users.aspx",appUrl:m.appUrl}).init();i();b();n();g();j(c.dataType);l();PDP.Pdb.Results({tableTarget:"#pdp-pdb-table-data",tablePagerTarget:"#pdp-pdb-table-pager",columnSelectTarget:"#pdp-pdb-table-col-selector",exportTarget:"#pdp-pdb-table-export",mapTitleTarget:"#pdp-map-title-content",tableTitleTarget:"#pdp-pdb-table-toolbar"}).init();PDP.Pdb.Search({target:"#pdp-pdb-view"}).init();PDP.Nychanis.Search({target:"#pdp-nychanis-view"}).init();PDP.Nychanis.Results({tableTarget:"#pdp-nychanis-table-data",tablePagerTarget:"#pdp-nychanis-table-pager",exportTarget:"#pdp-nychanis-table-export",mapTitleTarget:"#pdp-map-title-content",tableTitleTarget:"#pdp-nychanis-table-toolbar"}).init();try{a.Widget.Map({target:"#pdp-map-content"}).init()}catch(p){Azavea.log(p);a.Util.alert("Google Maps is currently unavailable.  You will not be able to view any map data, however, your search results will still be displayed in the table view.  \nPlease try refreshing your browser to reload Google Maps.","Google Maps Unavailable")}a.Util.initLoginStatus();a.Widget.PanelCloser().init();var q=Feedbacker.init({orientation:"left",css:{"z-index":9999,bottom:"40px"},onSuccess:function(){a.Util.quickAlert("Thank you for sending your feedback!","Feedback Submitted")}});$(window).resize();a.Widget.Splash({backgroundOpacity:0.5}).init();return k});return k}}(PDP));